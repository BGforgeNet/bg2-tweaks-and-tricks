<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <style type="text/css">
    /*<![CDATA[*/
    <!-- 
      body {
        margin: 0;
        padding: 0;
        cursor: default;
        text-align: center;
        color: #000;
        background: #e3e3db url('http://spellholdstudios.net/images/sh_bg_main.jpg');
      }
      
      #wrap {
        text-align: left;
        margin: 0 auto;
        margin-top: 20px;
        width: 88%;
        font-family: Verdana, Tahoma, Arial, sans-serif;
        font-size: 12px;
        color: #333;
      }
      
      #header {
        text-align: center;
        background: #e5e5e5;
        border: 1px solid #781808;
        border-top: 5px solid #781808;
        border-bottom: 5px solid #781808;
        padding: 5px 0 13px 0;
      }
      
      #header .about {
        margin: 7px 0 0 0;
        padding: 0;
        font-style: italic;
        color: #555;
      }
      
      #header .menu {
        font-weight: bold;
        margin: 0;
        color: #999;
      }

      #header .menu a:link,
      #header .menu a:visited {
        color: #333;
      }
      
      #maindiv {
        margin: 0 auto;
        margin-top: -20px;
        width: 95%;
      }
      
      #maindiv .content {
        counter-increment: kman;
        counter-reset: h2;
        background-color: #e8e8e6;
        padding: 0 0 25px 0;
        margin: 50px auto;
        border-width: 1px 1px 4px 10px;
        border-style: solid;
        border-color: #781808;
        position: relative;
        display: block;
      }
      
      #maindiv .content::before {
        content: counter(kman, lower-roman);
        font-size: 100%;
        font-weight: bold;
        text-align: center;
        color: #eee;
        background-color: #781808;
        width: 35px;
        position: absolute;
        top: 0px;
        left: 0px;
        display: block;
      }
      
      h2 {
        display: block;
        font-family: Verdana, Trebuchet MS, Arial, serif;
        text-align: left;
        text-indent: 30px;
        padding: 0px;
        margin: 20px 0 0 0;
        border-bottom: dotted 2px #d0d0d0;
        border-top: dotted 2px #d0d0d0;
        background: #deded9;
        font-size: 160%;
      }
      
      h2::first-letter {
        color: #781808;
        background-color: transparent;
      }
      
      #maindiv p {
	font-size: 100%;
	font-style: normal;
	line-height: 150%;
	padding: 0px;
	margin: 10px auto;
	width: 90%;
	display: block;
	text-align: justify;
      }
      
      #maindiv address a:link,
      #maindiv address a:visited {
        font-weight: bold;
        text-decoration: underline;
        background-color: transparent;
        color: #eaeaea !important;
        padding-right: 5px;
        padding-left: 6px;
      }
      
      #maindiv address a:focus,
      #maindiv address a:hover {
        text-decoration: none;
        color: #F1F1F1;
        border: 0;
      }
      
      #maindiv address a:active {
        color: #fff;
        text-decoration: line-through;
        border: none;
      }
      
      #maindiv address {
        font-size: 95%;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        color: #BBB;
        background-color: #781808;
        padding: 3px 0px 0px;
        margin: 0px;
        width: 100%;
        position: absolute;
        bottom: -1px;
        left: 0px;
        display: block;
        text-align: right;
      }
      
      #maindiv .important {
        font-size: 95%;
        font-family: Verdana;
        text-align: left;
        background-color: #F1F1F1;
        border-top: solid 1px #aaa;
        border-bottom: solid 1px #aaa;
        border-left: solid 6px #aaa;
        border-right: solid 6px #aaa;
        padding: 10px;
        margin: 20px auto;
        width: 80%;
        line-height: 160%;
      }
      
      #maindiv .important::before {
        display: none;
      }
      
      #maindiv .important p {
        font-size: 100%;
        text-indent: 0px;
        margin: 5px 0 10px 0;
      }
      
      #maindiv ul {
	margin: -10px 0 0 30px;
        *margin-left: 65px;
      }
      
      #maindiv ol {
        margin: -10px 0 0 35px;
        *margin-left: 70px;
      }
      
      #maindiv .important ul {
        margin: -10px 0 0 15px;
      }
      
      #maindiv .important ol {
        margin: -10px 0 0 20px;
      }
      
      #maindiv ul li {
	list-style-type: square;
	line-height: 150%;
	text-align: justify;
	margin-right: 5%;
      }
      
      #maindiv ol li {
	line-height: 150%;
	text-align: justify;
	margin-right: 5%;
      }
      
      .t1 {
        font-weight: bold;
        width: 26%;
        text-align: right;
        clear: right;
        float: left;
        *float: none;
        *margin-left: 65px;
        line-height: 22px;
      }
      
      .t2 {
        text-align: left;
        width: 73%;
        float: right;
        *float: none;
        line-height: 22px;
      }
      
      hr {
        margin: 10px 0 10px 0;
        padding: 0;
        height: 1px;
        border: 0;
        color: #aaa;
        background-color: #aaa;
      }
      
      hr.floatfix {
        clear: both;
        color: #e8e8e6;
        background-color: #e8e8e6;
        *margin: 0;
        *padding: 0;
      }
      
      h1 {
        font-size: 225%;
        color: #444;
        padding: 5px 0 5px 0;
        margin: 0;
        width: 100%;
      }
      
      h3,
      h4,
      h5 {
        margin: 10px 40px 10px 40px;
        padding: 0;
      }
      
      h3 {
        font-size: 125%;
        font-style: italic;
      }
      
      h4 {
        font-size: 125%;
      }
      
      h5 {
        font-size: 100%;
      }
      
      h6 {
        width: 100%;
        margin: 10px 0 15px 0;
        background-color: #ECECEC;
        text-align: left;
        text-indent: 30px;
        font-size: 100%;
        padding-top: 1px;
        padding-bottom: 1px;
        border-bottom: solid 1px #bbb;
        border-top: solid 1px #bbb;
      }
      
      a:link,
      a:visited {
        color: #781808;
        font-weight: bold;
        text-decoration: none;
      }

      a:hover,
      a:active {
        color: #222;
        border-bottom: 1px solid black;
      }

    -->
    /*]]>*/
    </style>
    <title>SPELLHOLD STUDIOS - Throne of Bhaal Extender Modder Reference</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>
  <body>
    <a name="top" id="top"></a>
    <div id="wrap">
      <div id="header">
        <h1>Throne of Bhaal Extender (TobEx)</h1>
        <strong>Modder Reference</strong>
        <hr />
        <p class="menu">
          <p><a href="#intro">Introduction</a></p>
          <p>Main: <a href="#engine">Engine</a> &middot;
          <a href="#debugging">Debugging</a> &middot;
          <a href="#lua">Lua</a> &middot;
          <a href="#ruleset">Ruleset</a></p>
          <p>Scripting: <a href="#triggers">Triggers</a> &middot;
          <a href="#actions">Actions</a> &middot;
          <a href="#stats">Scripting Stats</a></p>
          <p><a href="#audio">Audio</a> &middot;
          <a href="#animations">Animations and Graphics</a> &middot;
          <a href="#effects">Effects</a> &middot;
          <a href="#items">Items</a> &middot;
          <a href="#spells">Spells</a> &middot;
          <a href="#stores">Stores</a>
        </p>
      </div>
      <div id="maindiv">

        <!-- ================== I n t r o d u c t i o n ================== -->
        <a name="intro" id="intro"></a>
        <div class="content">
          <h2>Introduction</h2>
          <p>This document is intended to be a modmaker's reference that answers the question: "What can TobEx allow me to do as a modder?". It is not intended for players. It is not intended to answer the question: "How can I change the game with TobEx to do X?" This document is purely descriptive, and contains little to no information about how to achieve a certain modding goal.</p>
          <p>This document is intended to be used in conjunction with the <a href="http://iesdp.gibberlings3.net/">Infinity Engine Structures Description Project</a> and with ./TobEx_redist/TobEx_ini.txt. Please refer to each of these resources accordingly.</p>
          <p>Technically, TobEx functions conceptually by applying a group of hacks to the engine. This is achieved by loading a DLL at game startup. The DLL contains code that modifies the virtual image of the game executable BGMain.exe by:<p>
          <ul>
            <li>directly changing hex code (patch), and</li>
            <li>replacing and/or extending existing game functions (hook).</li>
          </ul>
          <p>Hacks may be exclusively patch, exclusively hook, or a combination of both. To enable easier troubleshooting, all hacks can be enabled/disabled by .ini files. Additionally, TobEx allows users to specify their own custom patches in the TobEx_ini/patch directory. Usage of this feature can be learnt from the template.patch file found in that directory.</p>
          <p>Overall, TobEx divides hacks into core hacks and tweak hacks. Core hacks are enabled/disabled in TobEx_ini/TobExCore.ini, while tweak hacks are enabled/disabled in TobEx_ini/TobExTweak.ini. In general, modders should not allow players to configure core hacks. Modders and players can configure core debugging hacks manually for their own debugging purposes. In contrast, modders can include components in their modifications that allow players to configure tweak hacks. The standalone package of TobEx allows some, but not all, of these tweak hacks to be configured. In this document, any behaviours that are not enabled by a default installation of the TobEx redistributable package or the core component of the TobEx standalone package are described using the keyword <strong>option</strong>.</p>
          <p>In the .ini files, TobEx hacks are grouped by type. To browse each hack by type, refer to ./TobEx_redist/TobEx_ini.txt. This document groups the features of TobEx differently to allow easier navigation. If any more information is sought beyond these resources, modders can discuss their questions at the <a href="http://www.shsforums.net/forum/606-tobex/">TobEx forum</a>.</p>

           <address>
            <span class="footer">TobEx &gt; Introduction</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== E n g i n e ================== -->
        <a name="engine" id="engine"></a>
        <div class="content">
          <h2>Engine</h2>
          <p>The following core engine changes are discussed:</p>
          <ul>
            <li><a href="#engine-arenas">Arenas Game Type</a></li>
            <li><a href="#engine-attacking">Attacking</a></li>
            <li><a href="#engine-auto-pause">Auto-pause</a></li>
            <li><a href="#engine-bard-song">Bard Song</a></li>
            <li><a href="#engine-casting">Casting Graphics and Sounds</a></li>
            <li><a href="#engine-creatures-moving-areas">Creatures Moving Between Areas</a></li>
            <li><a href="#engine-dead-statics">Dead Static Animations</a></li>
            <li><a href="#engine-dialogue-bar">Dialogue Bar</a></li>
            <li><a href="#engine-difficulty">Difficulty</a></li>
            <li><a href="#engine-effect-saves">Effect Saving Throws</a></li>
            <li><a href="#engine-effect-stacking">Effect Stacking Behaviour</a></li>
            <li><a href="#engine-fake-talk-exploit">Fake Talk Exploit</a></li>
            <li><a href="#engine-gaining-xp">Gaining Experience</a></li>
            <li><a href="#engine-inventory-pause">Inventory Screen Pausing</a></li>
            <li><a href="#engine-item_recharge">Item Recharge in Bags and Stores</a></li>
            <li><a href="#engine-kit-support">Kit Support</a></li>
            <li><a href="#engine-launchers">Launcher Fixes</a></li>
            <li><a href="#engine-music">Music Song List</a></li>
            <li><a href="#engine-player1-death">Player 1 Death</a></li>
            <li><a href="#engine-race-selection">Race Selection Strings</a></li>
            <li><a href="#engine-random-treasure">Random Treasure</a></li>
            <li><a href="#engine-rest-spawns">Rest Spawns</a></li>
            <li><a href="#engine-spell-turning">Spell Turning</a></li>
            <li><a href="#engine-starting-xp">Starting Experience</a></li>
            <li><a href="#engine-summon-limit-bug">Summon Limit Bug</a></li>
            <li><a href="#engine-talking-to-charmed">Talking to Charmed Creatures</a></li>
            <li><a href="#engine-variables">Variables</a></li>
          </ul>
          <hr />
          <a name="engine-arenas" id="engine-arenas"></a><h3>Arenas Game Type</h3>
          <p>The arenas game type is a deathmatch multiplayer game type disabled by BioWare in the release version of Throne of Bhaal. TobEx reactivates this game type, with all its features and bugs. Here is a summary of the game type:</p>
          <ul>
            <li>Games are called scenarios and are loaded as saved games from the ./arenas directory</li>
            <li>Pausing the game is not allowed</li>
            <li>The game does not end when Player1 dies</li>
            <li>LOCALSKickedOut is not set on death</li>
            <li>Only inventory slot items are dropped on death</li>
            <li>The DeathmatchPosition() actions set the DEATHMATCH_RESURRECT&lt;PLAYERNUM&gt; variable</li>
            <li>When the action DeathmatchPosition() is used, a player who dies will immediately Raise Dead and LeaveAreaLua() to the position set by DeathmatchPosition(), with a random orientation</li>
            <li>Gold is not shared by the party but is kept by the player</li>
            <li>Opposing players' health is not shown overhead and tooltips reveal approximate health</li>
            <li>No locator feedback is displayed when opposing players are damaged</li>
            <li>Opposing players' visibility maps are not displayed</li>
            <li>Party effects do not affected opposing players, hostile non-party effects affect opposing players</li>
            <li>Chunk death is disabled</li>
            <li>The default action when clicking on the portrait of an opposing player is to attack when in visibility range, and to move to opposing player when outside visibility range</li>
            <li>Record screen information on opposing players is not accessible</li>
          </ul>
          <p>The limitations of the game type are:</p>
          <ul>
            <li>Multiplayer permissions cannot be set correctly when setting up the game</li>
            <li>The host can reform party, kicking out other players</li>
            <li>The party can rest, all party members will heal, and the party cannot rest when the party is scattered (including opposing players)</li>
            <li>Any player can modify the party position of all party members</li>
            <li>Dialogue can be made to pause the game</li>
            <li>One can see the opposing player's kit description</li>
            <li>When outside visibility range, clicking on an opposing player's portrait allows the player to locate their opponents</li>
            <li>Summoned creatures turn enemy when hit by opposing players</li>
          </ul>
          <hr />
          <a name="engine-attacking" id="engine-attacking"></a><h3>Attacking</h3>
          <p>TobEx makes the following changes to the standard attack action:</p>
          <ul>
            <li>With X/2 attacks, the attack that occurs once every two rounds now always occurs every two rounds (rather than a random probability of the attack taking place every single round)</li>
            <li>With 3/2 attacks, the attack that occurs once every two rounds now always uses the offhand if an offhand weapon is present (rather than the offhand never being used)</li>
          </ul>
          <p><strong>Option:</strong> TobEx gives the option of making all attack animations genuine statistical attacks.</p>
          <hr />
          <a name="engine-auto-pause" id="engine-auto-pause"></a><h3>Auto-pause</h3>
          <p><strong>Option:</strong> TobEx gives the option of allowing auto-pause to work on any screen in single player. The behavior mimics that of multiplayer. The original behaviour is that auto-pause only works in the main game screen when in single player.</p>
          <hr />
          <a name="engine-bard-song" id="engine-bard-song"></a><h3>Bard Song</h3>
          <p>TobEx externalises the standard Bard Song effects to bardsong.spl. This allows modders to customise the standard set of Bard Song effects.</p>
          <hr />
          <a name="engine-casting" id="engine-casting"></a><h3>Casting Graphics and Sounds</h3>
          <p>Normally, female gender uses a female casting sound, other and niether gender use an unvoiced casting sound, and all other genders use a male casting sound. This caused problems with spells like Project Image where illusory female creatures used male casting sounds.</p>
          <p>TobEx fixes this bug by modifying the way that the gender of casting sound selection is handled. Specifically, male gender uses a male casting sound, while all other genders check the Sex field (0x237) in the CRE file format. If the Sex field is male (1), a male casting sound is used. If the Sex field is female (2), a female casting sound is used. For any other value in the Sex field, an unvoiced casting sound is used. In order to do this, TobEx also ensures that the Sex field is correctly set during character generation, and patches some characters and creatures (a la BG2 Fixpack) so that their Sex field is correct.</p>
          <p>TobEx also fixes a bug where the Mental Speed stat is not considered when determining whether to play a casting sound at all, whether to play a gendered or unvoiced casting sound, and whether to play a casting animation.</p>
          <hr />
          <a name="engine-creatures-moving-areas" id="engine-creatures-moving-areas"></a><h3>Creatures Moving Between Areas</h3>
          <p>TobEx fixes a bug whereby creatures moving between areas can get multiple copies saved in the area file in a saved game. This bug was fixed in the Throne of Bhaal 26499 BETA patch, and the fix is re-created by TobEx.</p>
          <p>TobEx also fixes a bug where creatures chasing targets through an area transition can be cloned because the creature was not removed from the previous area.</p>
          <hr />
          <a name="engine-dead-statics" id="engine-dead-statics"></a><h3>Dead Static Animations</h3>
          <p>TobEx fixes a bug where dead static animations are still valid scripting targets. Normally, this causes bugs where a creature in berserk amongst dead static animations will permanently remain in berserk, breaking game transitions.</p>
          <hr />
          <a name="engine-dialogue-bar" id="engine-dialogue-bar"></a><h3>Dialogue Bar</h3>
          <p>TobEx greatly expands the amount of text that can display in the dialogue bar before old text is lost. The number of rows supported is 32767.</p>
          <hr />
          <a name="engine-difficulty" id="engine-difficulty"></a><h3>Difficulty</h3>
          <p>TobEx allows modmakers to modify the damage percentage modifier for each difficulty level by extenalising the values to DIFFMOD.2DA.</p>
          <div class="important">
            <p>DIFFMOD.2DA<br />
            <br />
            DAMAGE_MOD: The percentage to add to base damage<br />
            LUCK_MOD: The amount to add to luck of party members<br />
            [ROWNAME]: Difficulty level based on DIFFLEV.IDS<br />
          </div>
          <hr />
          <a name="engine-effect-saves" id="engine-effect-saves"></a><h3>Effect Saving Throws</h3>
          <p>TobEx makes the following changes to effect saving throws:</p>
          <ul>
            <li>If an effect has multiple saving throw types (e.g. all five), then the best saving throw of the target is used. However, as saving throw types are checked in order, better subsequent saving throw types are all checked, which can create an internal consistency when flagging which saving throw type is used. TobEx fixes this issue. The issue may not have any impact in-game.</li>
            <li>If a target of an effect does not save versus any type, but modifiers result in a successful save (i.e. effect save bonus, save bonus versus same mage school type, and specific save bonus versus object type), then a successful save is not reported in the dialogue bar.</li>
            <li>TobEx fixes an issue where targets with improved invisibility do not get a +4 saving throw bonus against effects from creatures that cannot see invisible.</li>
          </ul>
          <hr />
          <a name="engine-effect-stacking" id="engine-effect-stacking"></a><h3>Effect Stacking Behaviour</h3>
          <p>TobEx allows modmakers to configure when effects can stack. This is achieved by implementing bit 25 (Limit Effect Stacking) of the EFF V2.0 Header offset 0x0040 (Save Type), ITM V1.0 Feature Block offset 0x0024 (Save Type), and SPL V1.0 Feature Block offset 0x0024 (Save Type).</p>
          <p>When set, TobEx checks EFF V2.0 Header offset 0x0048 (Special), ITM V1.0 Feature Block offset 0x002c (Special), and SPL V1.0 Feature Block offset 0x002c (Special) for a unique stacking ID. If two effects of the same opcode are applied, both have Limit Effect Stacking Set, and both have the same stacking ID, then the latter applied effect is suspended in application until the former effect expires. Regardless of whether it is applied, the latter effect will expire at the same time that it would expire if it was applied. In other words, the total duration of some non-stacking effect opcode is not extended because more than one copy of the effect was applied.</p>
          <p>Stacking IDs are unique to the opcode being applied. To maintain uniqueness of stacking IDs between different mods, one recommendation is to use the higher word of Special as the modder's Infinity Engine Community Prefix, then use the lower word as an identifying ID. For example, 0x41360001 ('A6' 0x0001).</p>
          <p>TobEx also implements bit 26 (Internal: Suspend Effect Application) of the EFF V2.0 Header offset 0x0040 (Save Type), ITM V1.0 Feature Block offset 0x0024 (Save Type), and SPL V1.0 Feature Block offset 0x0024 (Save Type) to prevent effects with limited stacking from being applied.</p>
          <hr />
          <a name="engine-fake-talk-exploit" id="engine-fake-talk-exploit"></a><h3>Fake Talk Exploit</h3>
          <p>TobEx fixes an exploit where players could intend to initiate dialogue with a neutral creature, cancel their action, and then perform a hostile action instead, resulting in the creature wasting up to 10 seconds doing nothing before becoming hostile.</p>
          <hr />
          <a name="engine-gaining-xp" id="engine-gaining-xp"></a><h3>Gaining Experience</h3>
          <p><strong>Option:</strong> Normally, Throne of Bhaal gives the party 110% of the experience actually coded into creatures and given by the AddExperienceParty() action opcode. However, the amount coded into creatures (100%) is reported in the dialogue bar. TobEx gives the option of fixing this issue and giving the party the coded amount of experience (100%) in these situations.</p>
          <hr />
          <a name="engine-inventory-pause" id="engine-inventory-pause"></a><h3>Inventory Screen Pausing</h3>
          <p><strong>Option:</strong> TobEx gives the option of disabling a forced game pause when the inventory screen is opened in single player. The behavior mimics that of multiplayer.</p>
          <hr />
          <a name="engine-kit-support" id="engine-kit-support"></a><h3>Kit Support</h3>
          <p>Normally, Throne of Bhaal limits the total number of kits available to 256 before overflow occurs. TobEx expands this limit to 1280. Additionally, TobEx enables scrolling of the kit selection menu, such that each class is no longer limited to 10 kits.</p>
          <hr />
          <a name="engine-item_recharge" id="engine-item_recharge"></a><h3>Item Recharge in Bags and Stores</h3>
          <p>TobEx fixes an exploit where players could instantly restore the charges of rechargeable items by putting them in a bag and then taking them out again.</p>
          <p>From the technical perspective, TobEx modifies usages for non-stackable items with charges such that:</p>
          <ul>
            <li>Items in a store with usages of 0 are no longer loaded with usages of 1</li>
            <li>Putting items in bags no longer recharges the items, unless bit 14 of STO V1.0 Header offset 0x10 (Flags) is set, see below.</li>
            <li>TobEx adds functionality to bit 14 (Toggle Recharge) of STO V1.0 Header offset 0x10 (Flags). For bags, setting this bit will allow items to be recharged when placed in the bag. For stores, setting this bit will prevent items from recharging when sold to the store.</li>
            <li>The buy and sell prices of items that recharge now take into account the fact that they recharge.</li>
          </ul>
          <hr />
          <a name="engine-launchers" id="engine-launchers"></a><h3>Launchers with No Ammo</h3>
          <p>TobEx fixes an exploit where launcher weapons grant the damage and strength bonuses of non-launcher (4)-type abilities. This corrects the issue with non-ammo-requiring launcher weapons (using ranged (2) ability) granting extra damage when ammo is equipped. If this is enabled, damage bonuses of launcher abilities are only given for the first launcher (4)-type ability of the launcher weapon.</p>
          <p>TobEx also fixes an engine bug where no penalties were applied for having no proficiency points in bows, crossbows, and slings.</p>
          <hr />
          <a name="engine-music" id="engine-music"></a><h3>Music Song List</h3>
          <p>TobEx removes the 100-row limit on SONGLIST.2DA. The script action PlaySong() supports this change, and extended song numbers are recognised in ARE files.</p>
          <hr />
          <a name="engine-player1-death" id="engine-player1-death"></a><h3>Player 1 Death</h3>
          <p><strong>Option:</strong> TobEx enables modmakers to disable the game over cutscene when the protagonist dies. In order for the game to be over, modmakers must specify a condition where the new action opcode LoseGame() applies without fail. Also refer to the <a href="#actions-352">LoseGame() action opcode</a> section.</p>
          <hr />
          <a name="engine-race-selection" id="engine-race-selection"></a><h3>Race Selection Strings</h3>
          <p>TobEx externalises hard-coded string references in the character generation race selection screen to RACETEXT.2DA. This allows modmakers to translate or modify these strings to other text.</p>
          <hr />
          <a name="engine-random-treasure" id="engine-random-treasure"></a><h3>Random Treasure</h3>
          <p>TobEx extends the limit of rows in all the random treasure 2DA files from 10 to 99.</p>
          <hr />
          <a name="engine-rest-spawns" id="engine-rest-spawns"></a><h3>Rest Spawns</h3>
          <p><strong>Option:</strong> TobEx gives the option of advancing a random time up to, but not including, eight hours if resting is interrupted by spawns. All resting times of one hour or greater will display in the dialogue bar. Resting times less than one hour will not display in the dialogue bar.</p>
          <hr />
          <a name="engine-spell-turning" id="engine-spell-turning"></a><h3>Spell Turning</h3>
          <p>TobEx fixes a bug where on occasions, certain creatures with spell turning absorb spells rather than bouncing them back to the original caster.</p>
          <hr />
          <a name="engine-starting-xp" id="engine-starting-xp"></a><h3>Starting Experience</h3>
          <p><strong>Option:</strong> TobEx gives the option for modmakers to modify the starting experience of Shadows of Amn and Throne of Bhaal.</p>
          <p>TobEx allows setting the starting experience to zero without causing problems with character generation. This can be useful for partial and total conversions.</p>
          <hr />
          <a name="engine-summon-limit-bug" id="engine-summon-limit-bug"></a><h3>Summon Limit Bug</h3>
          <p>TobEx fixes a bug where the number of summons may increment permanently because those not existing in an area remain in the saved game. This bug was fixed in the Throne of Bhaal 26499 BETA patch, and the fix is re-created by TobEx.</p>
          <hr />
          <a name="engine-talking-to-charmed" id="engine-talking-to-charmed"></a><h3>Talking to Charmed Creatures</h3>
          <p><strong>Option:</strong> TobEx gives the option of allowing the player to talk to charmed or dominated creatures and preventing charmed and dominated creatures from losing their soundset.</p>
          <hr />
          <a name="engine-variables" id="engine-variables"></a><h3>Variables</h3>
          <p>TobEx optimises the code used for setting and finding variables. The variable map hash function uses the djb2 algorithm.</p>
          <address>
            <span class="footer">TobEx &gt; Engine</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== D e b u g g i n g ================== -->
        <a name="debugging" id="debugging"></a>
        <div class="content">
          <h2>Debugging</h2>
          <p>The debugging features of TobEx include:</p>
          <ul>
            <li>A console that logs a variety of internal and TobEx-specific text</li>
            <li>Expansion of the Lua console to enhance real-time debugging. See the <a href="#lua">Lua section</a> for more details.</li>
            <li>Message boxes of assertion failures will always show when they occur</li>
            <li>Internal logging text, including assertion failures, assertion warnings, network errors, and other internal messages, can be displayed in the TobEx console and logged to TobEx.log</li>
            <li>For assertion failures, TobEx reports a debugging address that is displayed in the console and logged to TobEx.log</li>
            <li>Provision of some information about assertion failures and warnings that previously had no specific message explaining what the problem was</li>
            <li>The dialogue bar can be logged to TobEx_dlg.log</li>
            <li>Missing resources can be logged to TobEx.log</li>
            <li>The function of the 'Restore Extra Combat Info Text' baldur.ini option has been restored</li>
          </ul>
          <p>Note that a number of TobEx debugging features are not automatically enabled, and therefore need to be enabled manually by modifying ./TobEx_ini/TobExCore.ini after installation of TobEx. For the greatest amount of debugging information, set all the hacks in the [Debug] section of ./TobEx_ini/TobExCore.ini to 1. Refer to TobEx_redist/TobEx_ini.txt for specific information about each hack.</p>
          <address>
            <span class="footer">TobEx &gt; Debugging</span> <a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== L u a ================== -->
        <a name="lua" id="lua"></a>
        <div class="content">
          <h2>Lua</h2>
          <p>Baldur's Gate II: Throne of Bhaal uses Lua 3.0 in a limited fashion to facilitate debugging. For an introduction to Lua 3.0 and lua programming syntax, read <a href="http://www.lua.org/manual/3.0/manual.html#4.">Chapter 4</a> of the <a href="http://www.lua.org/manual/3.0/">Lua manual</a>. For a brief description of the CLUAConsole commands, refer to the <a href="http://iesdp.gibberlings3.net/appendices/clua/bg2.htm">Infinity Engine Structures Description Project website</a>.</p>
          <p>TobEx makes changes to the following CLUAConsole functions:</p>
          <ul>
            <li><strong>StartStore(ResRef)</strong>: TobEx fixes the crash associated with using this function, which starts the store named by ResRef with Player1 as the customer.</li>
          </ul>
          <hr />
          <p>TobEx expands on the use of Lua 3.0 for in-game debugging purposes and provides capabilities for modders and users to extend Lua debugging functions. Preset Lua functions imported into Baldur's Gate II: Throne of Bhaal are those described only in <a href="http://www.lua.org/manual/3.0/manual.html#6.1">Chapter 6.1</a> of the <a href="http://www.lua.org/manual/3.0/">Lua Reference Manual</a>. New user-defined functions can be defined by extending TobEx_ini/TobEx.lua or included .lua files. TobEx defines the following new functions:</p>
          <h3>Global functions (defined internally in C)</h3>
          <ul>
            <li><a href="#lua-band">band</a></li>
            <li><a href="#lua-bor">bor</a></li>
            <li><a href="#lua-createobject">createobject</a></li>
            <li><a href="#lua-dec2hex">dec2hex</a></li>
            <li><a href="#lua-hex2dec">hex2dec</a></li>
            <li><a href="#lua-getsprite">getsprite</a></li>
            <li><a href="#lua-mod">mod</a></li>
            <li><a href="#lua-pow">pow</a></li>
            <li><a href="#lua-pushfunction">pushfunction</a></li>
            <li><a href="#lua-pushuserdata">pushuserdata</a></li>
            <li><a href="#lua-u2n">u2n</a></li>
          </ul>
          <h3>TobExObject tag methods (defined internally in C)</h3>
          <ul>
            <li><a href="#lua-cdecl">cdecl</a></li>
            <li><a href="#lua-getaddress">getaddress</a></li>
            <li><a href="#lua-getbyte">getbyte</a></li>
            <li><a href="#lua-getdword">getdword</a></li>
            <li><a href="#lua-getlist">getlist</a></li>
            <li><a href="#lua-getpointer">getpointer</a></li>
            <li><a href="#lua-getstring">getstring</a></li>
            <li><a href="#lua-getword">getword</a></li>
            <li><a href="#lua-print">print</a></li>
            <li><a href="#lua-stdcall">stdcall</a></li>
          </ul>
          <h3>Global functions (defined externally in Lua)</h3>
          <ul>
            <li><a href="#lua-area_getcurrent">area_getcurrent</a></li>
            <li><a href="#lua-area_listsprites">area_listsprites</a></li>
            <li><a href="#lua-creature_getstat">creature_getstat</a></li>
            <li><a href="#lua-creature_liststates">creature_liststates</a></li>
            <li><a href="#lua-creature_listtriggers">creature_listtriggers</a></li>
            <li><a href="#lua-creature_listactions">creature_listactions</a></li>
            <li><a href="#lua-creature_listtriggerobjects">creature_listtriggerobjects</a></li>
            <li><a href="#lua-creature_listscripts">creature_listscripts</a></li>
            <li><a href="#lua-dump">dump</a></li>
            <li><a href="#lua-dump_table">dump_table</a></li>
            <li><a href="#lua-p">p</a></li>
            <li><a href="#lua-sprite_getcurrent">sprite_getcurrent</a></li>
            <li><a href="#lua-sprite_gettype">sprite_gettype</a></li>
          </ul>
          <hr />
          <a name="lua-area_getcurrent" id="lua-area_getcurrent"></a><h4>area_getcurrent()</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (area.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> None</li>
            <li><strong>Returns:</strong> TobExObject (type "area")</li>
            <li><strong>Behaviour:</strong> Creates a TobExObject referencing the current area.</li>
          </ul>
         <hr />
          <a name="lua-area_listsprites" id="lua-area_listsprites"></a><h4>area_listsprites(are)</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (area.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> are - TobExObject (type "area")</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Dumps text of all the sprites in the current area into the dialogue window.</li>
          </ul>
          <hr />
          <a name="lua-band" id="lua-band"></a><h4>band(x,y)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> x,y - number of hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Performs a bitwise AND (x & y) operation. There is no operator synonym for this function.</li>
          </ul>
          <hr />
          <a name="lua-bor" id="lua-bor"></a><h4>bor(x,y)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> x,y - number of hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Performs a bitwise OR (x | y) operation. There is no operator synonym for this function.</li>
          </ul>
          <hr />
          <a name="lua-cdecl" id="lua-cdecl"></a><h4>cdecl(f, [args...])</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> f - cfunction; args... (optional) - any type</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Pushes 'args...' onto the C stack, and calls 'f' using the <i>cdecl</i> calling convention. Arguments of type Lua function and table are ignored, and arguments of nil or non-existent arguments terminate the argument list. The TobExObject is placed into the ecx register as per <i>thiscall</i>. The return value in the eax register is pushed onto the Lua stack as a number.</li>
          </ul>
          <hr />
          <a name="lua-createobject" id="lua-createobject"></a><h4>createobject(u, [type])</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> u - userdata; type (optional) - string</li>
            <li><strong>Returns:</strong> TobExObject</li>
            <li><strong>Behaviour:</strong> Creates a TobExObject referencing userdata of type "notype" or 'type' (if explicitly specified). A TobExObject is a global Lua table set to tag "TobExObject" containing the fields "type"->string and "userdata"->userdata. TobExObjects  have access to all functions under the TobExObject tag method scope.</li>
          </ul>
          <hr />
          <a name="lua-creature_getstat" id="lua-creature_getstat"></a><h4>creature_getstat(cre, n)</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (creature.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> cre - TobExObject (type "creature"); n - number</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Gets the value of stat number 'n' of the creature.</li>
          </ul>
          <hr />
          <a name="lua-creature_listactions" id="lua-creature_listactions"></a><h4>creature_listactions(cre)</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (creature.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> cre - TobExObject (type "creature")</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Dumps text of all the actions of the creature into the dialogue window.</li>
          </ul>
          <hr />
          <a name="lua-creature_listscripts" id="lua-creature_listscripts"></a><h4>creature_listscripts(cre)</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (creature.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> cre - TobExObject (type "creature")</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Dumps text of the script ResRefs assigned to the creature, and the current script-block-response currently running, into the dialogue window.</li>
          </ul>
          <hr />
          <a name="lua-creature_liststates" id="lua-creature_liststates"></a><h4>creature_liststates(cre)</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (creature.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> cre - TobExObject (type "creature")</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Dumps text of all the states that apply to the creature into the dialogue window.</li>
          </ul>
          <hr />
          <a name="lua-creature_listtriggerobjects" id="lua-creature_listtriggerobjects"></a><h4>creature_listtriggerobjects(_cre)</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (creature.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> cre - TobExObject (type "creature")</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Dumps text of all the trigger objects of the creature into the dialogue window.</li>
          </ul>
          <hr />
          <a name="lua-creature_listtriggers" id="lua-creature_listtriggers"></a><h4>creature_listtriggers(cre)</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (creature.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> cre - TobExObject (type "creature")</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Dumps text of all the triggers of the creature into the dialogue window.</li>
          </ul>
          <hr />
          <a name="lua-dec2hex" id="lua-dec2hex"></a><h4>dec2hex(n)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> n - number</li>
            <li><strong>Returns:</strong> String</li>
            <li><strong>Behaviour:</strong> Converts a decimal number into a hexadecimal string beginning with "0x".</li>
          </ul>
          <hr />
          <a name="lua-dump" id="lua-dump"></a><h4>dump()</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> None</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Dumps text of all Lua global variables into the dialogue window.</li>
          </ul>
          <hr />
          <a name="lua-dump_table" id="lua-dump_table"></a><h4>dump_table(t, name)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> t - table; name - string</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Dumps text of a Lua table into the dialogue window. 'name' is displayed as a prefix to every line of the dump.</li>
          </ul>
          <hr />
          <a name="lua-getaddress" id="lua-getaddress"></a><h4>getaddress(address)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> address - number or hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Userdata</li>
            <li><strong>Behaviour:</strong> Gets 'address' relative to the TobExObject reference address.</li>
          </ul>
          <hr />
          <a name="lua-getbyte" id="lua-getbyte"></a><h4>getbyte(address)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> address - number or hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Gets the byte (8-bit) value at 'address' relative to the TobExObject reference address.</li>
          </ul>
          <hr />
          <a name="lua-getdword" id="lua-getdword"></a><h4>getdword(address)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> address - number or hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Gets the dword (32-bit) value at 'address' relative to the TobExObject reference address.</li>
          </ul>
          <hr />
          <a name="lua-getlist" id="lua-getlist"></a><h4>getlist(address)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> address - number or hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Table</li>
            <li><strong>Behaviour:</strong> Pushes a table derived from the CPtrList object at 'address' relative to the TobExObject reference address. The index of each table element is the index from the head of a MFC CList object {0,1,2,...}, and the value is its corresponding value.</li>
          </ul>
          <hr />
          <a name="lua-getpointer" id="lua-getpointer"></a><h4>getpointer(address)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> address - number or hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Userdata</li>
            <li><strong>Behaviour:</strong> Gets the value (pointer) at 'address' relative to the TobExObject reference address.</li>
          </ul>
          <hr />
          <a name="lua-getsprite" id="lua-getsprite"></a><h4>getsprite(enum|scriptname)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> enum - number or hexadecimal string (beginning with "0x"); scriptname - string</li>
            <li><strong>Returns:</strong> Userdata</li>
            <li><strong>Behaviour:</strong> Gets a reference to a game sprite by by enum (instance index) or scriptname as type userdata.</li>
          </ul>
          <hr />
          <a name="lua-getstring" id="lua-getstring"></a><h4>getstring(address, [length])</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> address - number or hexadecimal string (beginning with "0x"); length (optional) - number</li>
            <li><strong>Returns:</strong> String</li>
            <li><strong>Behaviour:</strong> Gets the string (terminating at the first nul character, or of specified length 'length') at 'address' relative to the TobExObject reference address.</li>
          </ul>
          <hr />
          <a name="lua-getword" id="lua-getword"></a><h4>getword(address)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> address - number or hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Gets the word (16-bit) value at 'address' relative to the TobExObject reference address.</li>
          </ul>
          <hr />
          <a name="lua-hex2dec" id="lua-hex2dec"></a><h4>hex2dec(string)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> string - hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Converts a hexadecimal string to a decimal number.</li>
          </ul>
          <hr />
          <a name="lua-mod" id="lua-mod"></a><h4>mod(x,y)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> x,y - number of hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Performs a mod (x mod y) operation.</li>
          </ul>
          <hr />
          <a name="lua-p" id="lua-p"></a><h4>p(text)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> text - any type</li>
            <li><strong>Returns:</strong> None</li>
            <li><strong>Behaviour:</strong> Prints 'text' to the dialogue window. Synonym for CLUAConsole::DisplayText(tostring(text)).</li>
          </ul>
          <hr />
          <a name="lua-pow" id="lua-pow"></a><h4>pow(x, y)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> x,y - number of hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Performs a pow (x ^ y) operation. Operator ^ can be used as a synonym for this function (defined in TobEx.lua).</li>
          </ul>
          <hr />
          <a name="lua-print" id="lua-print"></a><h4>print([to_console])</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> to_console - boolean</li>
            <li><strong>Returns:</strong> String (only when to_console == false)</li>
            <li><strong>Behaviour:</strong> Dumps hard-coded type-based information about the TobExObject into a string. If to_console is true, the text is placed into the dialogue window.</li>
          </ul>
          <hr />
          <a name="lua-pushfunction" id="lua-pushfunction"></a><h4>pushfunction(n)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> n - number of hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> CFunction</li>
            <li><strong>Behaviour:</strong> Converts a number to a cfunction.</li>
          </ul>
          <hr />
          <a name="lua-pushuserdata" id="lua-pushuserdata"></a><h4>pushuserdata(n)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> n - number of hexadecimal string (beginning with "0x")</li>
            <li><strong>Returns:</strong> Userdata</li>
            <li><strong>Behaviour:</strong> Converts a number to userdata with tag 0.</li>
          </ul>
          <hr />
          <a name="lua-sprite_getcurrent" id="lua-sprite_getcurrent"></a><h4>sprite_getcurrent()</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (sprite.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> None</li>
            <li><strong>Returns:</strong> TobExObject (type variable)</li>
            <li><strong>Behaviour:</strong> Creates a TobExObject of the sprite highlighted by the game cursor. The TobExObject type is preset using sprite_gettype().</li>
          </ul>
          <hr />
          <a name="lua-sprite_gettype" id="lua-sprite_gettype"></a><h4>sprite_gettype(obj)</h4>
          <ul>
            <li><strong>Type:</strong> Lua function (sprite.lua)</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> obj - TobExObject</li>
            <li><strong>Returns:</strong> String</li>
            <li><strong>Behaviour:</strong> Gets the specific type of the TobExObject as a string.</li>
          </ul>
          <hr />
          <a name="lua-stdcall" id="lua-stdcall"></a><h4>stdcall(f, [args...])</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> TobExObject tag method</li>
            <li><strong>Parameters:</strong> f - cfunction; args... (optional) - any type</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Pushes 'args...' onto the C stack and calls 'f' using the <i>stdcall</i>/<i>thiscall</i> calling convention. Arguments of type Lua function and table are ignored, and arguments of nil or non-existent arguments terminate the argument list. The TobExObject is placed into the ecx register as per <i>thiscall</i>. If too many or too few arguments are supplied for the function, the stack pointer is corrected. The return value in the eax register is pushed onto the Lua stack as a number.</li>
          </ul>
          <hr />
          <a name="lua-u2n" id="lua-u2n"></a><h4>u2n(u)</h4>
          <ul>
            <li><strong>Type:</strong> C function</li>
            <li><strong>Scope:</strong> Global</li>
            <li><strong>Parameters:</strong> u - userdata</li>
            <li><strong>Returns:</strong> Number</li>
            <li><strong>Behaviour:</strong> Converts a userdata to number.</li>
          </ul>
          <address>
            <span class="footer">TobEx &gt; Lua</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>
        
        <!-- ================== R u l e s e t ================== -->
        <a name="ruleset" id="ruleset"></a>
        <div class="content">
          <h2>Ruleset</h2>
          <p>The following ruleset changes are discussed:</p>
          <ul>
            <li><a href="#ruleset-assassin">Assassin and Bounty Hunter Kits</a></li>
            <li><a href="#ruleset-backstabbing">Backstabbing</a></li>
            <li><a href="#ruleset-casting-silence">Casting Spells When Silenced</a></li>
            <li><a href="#ruleset-class-race">Class-Race Restrictions</a></li>
            <li><a href="#ruleset-contingency">Contingency/Trigger/Sequencer and Select Spell</a></li>
            <li><a href="#ruleset-critical-hits">Critical Hits</a></li>
            <li><a href="#ruleset-dual-classing">Dual Classing</a></li>
            <li><a href="#ruleset-equipping-armor">Equipping Armor in Combat</a></li>
            <li><a href="#ruleset-hla">High Level Abilities (HLAs)</a></li>
            <li><a href="#ruleset-hp-tables">Hit Point Tables</a></li>
            <li><a href="#ruleset-item-restrictions">Item Restrictions</a></li>
            <li><a href="#ruleset-mage-spells">Mage Spells</a></li>
            <li><a href="#ruleset-magical-weapons">Magical Weapons</a></li>
            <li><a href="#ruleset-mirror-images">Mirror Images</a></li>
            <li><a href="#ruleset-pickpocketing">Pickpocketing</a></li>
            <li><a href="#ruleset-priest-spells">Priest Spells</a></li>
            <li><a href="#ruleset-proficiencies">Proficiencies</a></li>
            <li><a href="#ruleset-spell-selection">Spell Selection</a></li>
            <li><a href="#ruleset-targetting-invisible">Targetting Invisible Creatures</a></li>
            <li><a href="#ruleset-weapon-slots">Weapon Slots</a></li>
            <li><a href="#ruleset-weapon-spec">Weapon Specialisation-associated Number of Attacks</a></li>
            <li><a href="#ruleset-weight-allowance">Weight Allowance</a></li>
          </ul>
          <hr />
          <a name="ruleset-assassin" id="ruleset-assassin"></a><h3>Assassin and Bounty Hunter Kits</h3>
          <p>When the unusability flags for Assassin (0x40000) and Bounty Hunter (0x80000) Kits are used for custom thief kits, TobEx applies the 15% (Assassin) or 20% (Bounty Hunter) thieving skill points disadvantage to these kits.</p>
          <hr />
          <a name="ruleset-backstabbing" id="ruleset-backstabbing"></a><h3>Backstabbing</h3>
          <p>Normally, only non-ranged items usable by thieves can be used for backstabbing. TobEx allows modmakers to invert this behaviour to customise what items can be used for backstabbing. TobEx adds functionality to bit 25 (Toggle backstab restrictions) of ITM V1.0 Extended Header offset 0x0026 (Flags). When set, this bit makes items normally unusable for backstabbing usable, and items normally usable for backstabbing unusable. For a ranged attack that hits, both launcher and ammo abilities are checked, and if at least one of the bits is set, backstabbing is toggled.<br />
          <br />
          Example</p>
          <table class="important">
            <tr>
              <td></td>
              <td>Usable by thief?</td>
              <td>Ranged</td>
              <td>Bit 25 Off</td>
              <td>Bit 25 On</td>
            </tr>
            <tr>
              <td>Dagger</td>
              <td>Yes</td>
              <td>No</td>
              <td>Backstab</td>
              <td>No backstab</td>
            </tr>
            <tr>
              <td>Warhammer</td>
              <td>No</td>
              <td>No</td>
              <td>No backstab</td>
              <td>Backstab</td>
            </tr>
            <tr>
              <td>Arrow</td>
              <td>Yes</td>
              <td>Yes</td>
              <td>No backstab</td>
              <td>Backstab</td>
              <td>//bit 25 can be set either on Arrow or Bow)</td>
            </tr>
            <tr>
              <td>Throwing Axe</td>
              <td>No</td>
              <td>Yes</td>
              <td>No backstab</td>
              <td>Backstab</td>
            </tr>
          </table>
          <hr />
          <a name="ruleset-casting-silence" id="ruleset-casting-silence"></a><h3>Casting Spells When Silenced</h3>
          <p>Normally, spells cannot be cast while silent unless the caster is affected by Vocalize. TobEx allows modmakers to enable specific spells to be cast when silenced, even when Vocalize is not applied. TobEx adds functionality to bit 25 (Can Be Cast When Silenced) of SPL V1.0 Header offset 0x0018 (Flags). When set and the spell is being cast, the spell will be cast but with a silenced casting sound of CHA_S*.WAV. The behaviour of Vocalize (SPWI219), Set Snare (SPCL412), Set Special Snare (SPCL414), and Pocket Plane (SPIN649), which are normally castable when silenced are not changed.</p>
          <hr />
          <a name="ruleset-class-race" id="ruleset-class-race"></a><h3>Class-Race Restrictions</h3>
          <p>TobEx externalises the restrictions of classes that are available to each race to CLSRCREQ.2DA. Mage school restrictions are externalised to MGSRCREQ.2DA. This allows modmakers to customise what classes are available to each race.<br />
          Note that there are no pre-existing animations for halfling mages and non-human monks. Therefore, animation IDs for the former are set to the halfling cleric and the latter to fighter of the same race</p>
          <hr />
          <a name="ruleset-contingency" id="ruleset-contingency"></a><h3>Contingency/Trigger/Sequencer and Select Spell</h3>
          <p>Normally, spells that use the Select Spell effect opcode such as Spell Immunity are not shown in the spell menu after casting Contingency or similar spells because the contingency behaviour does not work as intended when such a spell is stored in a contingency. TobEx modifies this by allowing players to select the child spells of a Select Spell effect opcode instead of the parent spell. To enable this behaviour for existing Throne of Bhaal spells, CONTINGX.2DA still needs to be modified to allow those spells to be displayed in the contingency menu.</p>
          <hr />
          <a name="ruleset-critical-hits" id="ruleset-critical-hits"></a><h3>Critical Hits</h3>
          <p>Normally, anything equipped in a helmet slot prevents critical hits. TobEx allows modmakers to invert this behaviour to customise what items avert critical hits. TobEx adds functionality to bit 25 (Toggle critical hit aversion) of ITM V1.0 Header offset 0x0018 (Flags). When set, this bit makes items equipped in helmet slots not avert critical hits, and items equipped in other slots avert critical hits.</p>
          <hr />
          <a name="ruleset-dual-classing" id="ruleset-dual-classing"></a><h3>Dual Classing</h3>
          <p><strong>Option:</strong> TobEx gives the option of allowing all races to dual class instead of just humans.</p>
          <hr />
          <a name="ruleset-equipping-armor" id="ruleset-equipping-armor"></a><h3>Equipping Armor in Combat</h3>
          <p><strong>Option:</strong> TobEx gives the option of allowing the player to change the armor slot of party members during combat.</p>
          <hr />
          <a name="ruleset-hla" id="ruleset-hla"></a><h3>High Level Abilities (HLAs)</h3>
          <p>TobEx fixes a bug where Cleric-Ranger classes had the cleric and ranger HLA rules swapped around. This was due to internal arrays being set up inconsistently when working out the number of HLAs available at level-up. Therefore, Cleric-Rangers correctly get their first HLA at Ranger level 13 (with cleric HLAs available due to level 7 spells being available), get one HLA for each Ranger level from level 13 and higher, and get one HLA for each Cleric level from level 15 and higher.</p>
          <hr />
          <a name="ruleset-hp-tables" id="ruleset-hp-tables"></a><h3>Hit Point Tables</h3>
          <p>TobEx externalises the usage of hit point tables to a master HPCLASS.2DA file. This specifies the hit point table to use by single class. This allows modmakers to use custom hit point tables by class.</p>
          <p>Additionally, TobEx externalises Barbarian from Fighter class hit point tables to HPBARB.2DA.</p>
          <hr />
          <a name="ruleset-item-restrictions" id="ruleset-item-restrictions"></a><h3>Item Restrictions</h3>
          <p>TobEx externalises creature-specific item restrictions to ITEM_USE.2DA. This allows modmakers to customise specific item restrictions for creatures in the style of Minsc's Boo and Xan's Moonblade.</p>
          <div class="important">
            <p>ITEM_USE.2DA<br />
            <br />
            [ROWNAME]: the resource name of the item that the item-creature restrictions apply to<br />
            USER: death variable/script name of creature (not case-sensitive)<br />
            STRREF#: the string reference to display in the inventory screen when the restriction indicated by the flag value of # applies<br />
            FLAG: bitfield indicating the type/s of restriction to apply<br />
            <br />
            FLAG bits<br />
            <ul>
              <li>bit 0 [1]: the item cannot be picked up from any slot of the creature (this overrides bits 3 and 4)</li>
              <li>bit 1 [2]: the item can only be equipped by the creature (this is 'stackable', so multiple item entries with different creatures mean that each of the listed creatures can equip the item)</li>
              <li>bit 2 [4]: no restrictions (this bit is reserved for GemRB)</li>
              <li>bit 3 [8]: the item cannot be picked up from any equipped slot of the creature</li>
              <li>bit 4 [16]: the item cannot be picked up from any inventory slot of the creature</li>
              <li>bit 5 [32]: the item cannot be dropped into any equipped slot of the creature</li>
              <li>bit 6 [64]: the item cannot be dropped into any inventory slot of the creature</li>
            </ul>
            <br />
            Example</p>
            <table class="important">
              <tr>
                <td></td>
                <td>USER</td>
                <td>STRREF</td>
                <td>FLAG</td>
                <td>STRREF2</td>
                <td>STRREF4</td>
                <td>STRREF8</td>
                <td>STRREF16</td>
                <td>STRREF32</td>
                <td>STRREF64</td>
              </tr>
              <tr>
                <td>MISC84</td>
                <td>MINSC</td>
                <td>10218</td>
                <td>3</td>
                <td>10218</td>
                <td>-1</td>
                <td>-1</td>
                <td>-1</td>
                <td>-1</td>
                <td>-1</td>
              </tr>
            </table>
            <p>Item MISC84 cannot be picked up from any slot of "Minsc", and can only be equipped by "Minsc".</p>
          </div>
          <hr />
          <a name="ruleset-mage-spells" id="ruleset-mage-spells"></a><h3>Mage Spells</h3>
          <p>TobEx allows the extension of the limit of possible mage spells selectable for mages and sorcerers by externalising the number of spells selectable to SPELLS.2DA. The cap for level 1-8 spells can be set to 99, while the cap for level 9 spells can be set to 199, for which spells 100-199 refer to SPWI0**.SPL.</p>
          <p>If this hack is used, it is recommended you use this hack with Externalize Mage Spell Hiding. Otherwise, unwanted spells will show up on spell selection screens. Also, assuming you provide maximum values for the number of spells in SPELLS.2DA, you should add to HIDESPL.2DA the following vanilla Throne of Bhaal spells:</p>
          <p class="important">SPWI298-299<br />SPWI399<br />SPWI483-491, 493-499<br />SPWI590-97<br />SPWI853, 888, 897-899<br />SPWI926-965, 979-999<br />SPWI001-027, 050-056</p>
          <hr />
          <a name="ruleset-magical-weapons" id="ruleset-magical-weapons"></a><h3>Magical Weapons</h3>
          <p>TobEx allows modmakers to create magical weapons that do not get dispelled in the magical weapon slot. Also refer to the <a href="#effects-58">Dispel Magic effect</a> section.</p>
          <hr />
          <a name="ruleset-mirror-images" id="ruleset-mirror-images"></a><h3>Mirror Images</h3>
          <p>TobEx allows modmakers to create effects that bypass mirror images. Also refer to the <a href="#effects-12">Damage effect</a> section.</p>
          <hr />
          <a name="ruleset-pickpocketing" id="ruleset-pickpocketing"></a><h3>Pickpocketing</h3>
          <p>TobEx allows modmakers to customise which item slots are amenable to pickpocketing, and the minimum skill level required to steal an item from each slot. This behaviour is governed by SLTSTEAL.2DA.</p>
          <p class="important">SLTSTEAL.2DA<br />
          <br />
          SKILL: The minimum pickpocketing skill with which the item in the item slot can be stolen. If the skill is set to 0, the item slot can never be stolen from. Note that the SLOT_FIST value is ignored.<br />
          [ROWNAME]: The name of the item slot. The row numbers are mapped to the item slot, not the name, except for SLOT_EQUIPPED. SLOT_EQUIPPED refers to the currently equipped weapon slot, or the currently equipped ammo slot and its launcher slot.</p>
          <hr />
          <a name="ruleset-priest-spells" id="ruleset-priest-spells"></a><h3>Priest Spells</h3>
          <p>TobEx allow extension of priest spells allowed at each level from 50 to 99 (SPPR*00-SPPR*99). This is still limited by SPELLS.2DA. If this hack is used, the following change should be made to SPELLS.2DA to avoid existing Throne of Bhaal priest spells that should not be included:</p>
          <p class="important">PRIEST  99  99  99  99  98  97  99</p>
          <hr />
          <a name="ruleset-proficiencies" id="ruleset-proficiencies"></a><h3>Proficiencies</h3>
          <p><strong>Option:</strong> TobEx gives the option of enabling the application of level one proficiency restrictions as dictated by PROFSMAX.2DA.<p>
          <p>TobEx allows additive modification of proficiencies by using a modified effect opcode #233. Also refer to the <a href="#effects-233">Proficiency Modifier effect</a> section.</p>
          <hr />
          <a name="ruleset-spell-selection" id="ruleset-spell-selection"></a><h3>Spell Selection</h3>
          <p>TobEx makes a number of changes to spell selection.</p>
          <p>For character generation and level-up, TobEx externalises spell selection restrictions to HIDESPL.2DA. This allows modmakers to customise what spells can and cannot be displayed in these spell selection screens. Additionally, TobEx adds scrollbars to the spell selection screens to allow players to select from a choice of more than 24 spells. This currently does not apply to high-level ability selection.</p>
          <p>For selecting spells to memorize in mage and priest spellbooks, TobEx adds scroll buttons to allow players to select from greater than 20 memorized spells for each level. At the moment, players cannot scroll through already memorized spells if they overflow the allowed space.</p>
          <hr />
          <a name="ruleset-targetting-invisible" id="ruleset-targetting-invisible"></a><h3>Targetting Invisible Creatures</h3>
          <p>Spells cannot be cast under normal conditions on creatures affected by invisibility, improved invisibility, and sanctuary. TobEx adds functionality to bit 24 (Can target invisible) of SPL V1.0 Header offset 0x0018 (Flags). When set, a player can target invisible, improved invisible, and sanctuary creatures with that spell.</p>
          <p>For items, TobEx adds functionality to bit 26 (Cannot target invisible) of ITM V1.0 Extended Header offset 0x0026 (Flags). When set, a player cannot target invisible, improved invisible, or sanctuary creatures with that item ability.</p>
          <hr />
          <a name="ruleset-weapon-slots" id="ruleset-weapon-slots"></a><h3>Weapon Slots</h3>
          <p>TobEx enables the option to give all classes the same number of weapon slots as fighters, who have four weapon slots. This currently only changes the inventory display and not the quick bar at the bottom of the screen.</p>
          <hr />
          <a name="ruleset-weapon-spec" id="ruleset-weapon-spec"></a><h3>Weapon Specialisation-associated Number of Attacks</h3>
          <p><strong>Option:</strong> TobEx gives the option of modifying the application of weapon specialisation-associated number of attacks bonuses described by WSPATCK.2DA. Specifically, all non-monk classes receive such a bonus based on their average level. Originally, ranger, paladin, and fighter classes received such a bonus based on their fighter level, while other non-monk classes received no bonus. Calculation of such a bonus for the monk class is unchanged.</p>
          <hr />
          <a name="ruleset-weight-allowance" id="ruleset-weight-allowance"></a><h3>Weight Allowance</h3>
          <p>TobEx allows modmakers to customise the percentage weight that defines low and high encumbrance through ENCUMBER.2DA. Additionally, TobEx allows additive modification of weight allowance by using a custom scripting stat #400. Also refer to the <a href="#stats">Scripting Stats</a> section.</p>
          <p class="important">ENCUMBER.2DA<br />
          <br />
          THRESHOLD: The percentage weight above which [ROWNAME] applies. If the THRESHOLD is set to 0, [ROWNAME] never applies. If the THRESHOLD is set to a negative number, the value is treated as invalid and the default hard-coded value is applied.<br />
          [ROWNAME]: Either LOW_ENCUMBRANCE (slowed) or HIGH_ENCUMBRANCE (cannot move)</p>
          <address>
            <span class="footer">TobEx &gt; Ruleset</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== T r i g g e r s ================== -->
        <a name="triggers" id="triggers"></a>
        <div class="content">
          <h2>Triggers</h2>
          <p>TobEx modifies the internal script compiler used for dialogues so that it recognises more trigger parameter constructions. These are:</p>
          <ul>
            <li>(S,I,I)</li>
            <li>(S,I,I,I)</li>
            <li>(S,O,I,I)</li>
            <li>(S,O,I,I,I)</li>
            <li>(S,S,O)</li>
          </ul>
          <hr />
          <p>TobEx makes changes to the following script trigger opcodes:</p>
          <ul>
            <li><a href="#triggers-4042">0x4042 PartyHasItem(S:Item*)</a></li>
            <li><a href="#triggers-4044">0x4044 CheckStat(O:Object*,I:Value*,I:StatNum*Stats)</a></li>
            <li><a href="#triggers-4044">0x4045 CheckStatGT(O:Object*,I:Value*,I:StatNum*Stats)</a></li>
            <li><a href="#triggers-4044">0x4046 CheckStatLT(O:Object*,I:Value*,I:StatNum*Stats)</a></li>
            <li><a href="#triggers-005d">0x005D PickPocketFailed(O:Object*)</a></li>
            <li><a href="#triggers-4061">0x4061 HasItem(S:ResRef*,O:Object*)</a></li>
            <li><a href="#triggers-40a9">0x40A9 PartyHasItemIdentified(S:ResRef*)</a></li>
            <li><a href="#triggers-40bb">0x40BB Kit(O:Object*,I:Kit*KIT)</a></li>
          </ul>
          <hr />
          <p>TobEx aldo adds the following new script trigger opcodes:</p>
          <ul>
            <li><a href="#triggers-4100">0x4100 NextTriggerObject(O:Object*)</a></li>
            <li><a href="#triggers-4101">0x4101 MovementRate(O:Object*,I:Value*)</a></li>
            <li><a href="#triggers-4101">0x4102 MovementRateGT(O:Object*,I:Value*)</a></li>
            <li><a href="#triggers-4101">0x4103 MovementRateLT(O:Object*,I:Value*)</a></li>
            <li><a href="#triggers-4104">0x4104 NumMirrorImages(O:Object*,I:Value*)</a></li>
            <li><a href="#triggers-4104">0x4105 NumMirrorImagesGT(O:Object*,I:Value*)</a></li>
            <li><a href="#triggers-4104">0x4106 NumMirrorImagesLT(O:Object*,I:Value*)</a></li>
            <li><a href="#triggers-4107">0x4107 BouncingSpellLevel(O:Object*,I:Level*)</a></li>
            <li><a href="#triggers-4108">0x4108 NumBouncingSpellLevel(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-4108">0x4109 NumBouncingSpellLevelGT(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-4108">0x410A NumBouncingSpellLevelLT(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-410b">0x410B ImmuneToSpellLevel(O:Object*,I:Level*)</a></li>
            <li><a href="#triggers-410c">0x410C NumImmuneToSpellLevel(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-410c">0x410D NumImmuneToSpellLevelGT(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-410c">0x410E NumImmuneToSpellLevelLT(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-410f">0x410F TimeStopCounter(I:Number*)</a></li>
            <li><a href="#triggers-410f">0x4110 TimeStopCounterGT(I:Number*)</a></li>
            <li><a href="#triggers-410f">0x4111 TimeStopCounterLT(I:Number*)</a></li>
            <li><a href="#triggers-4112">0x4112 TimeStopObject(O:Object*)</a></li>
            <li><a href="#triggers-4113">0x4113 NumTrappingSpellLevel(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-4113">0x4114 NumTrappingSpellLevelGT(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-4113">0x4115 NumTrappingSpellLevelLT(O:Object*,I:Level*,I:Amount*)</a></li>
            <li><a href="#triggers-4116">0x4116 OriginalClass(O:Object*,I:Class*Class)</a></li>
            <li><a href="#triggers-4117">0x4117 HPLost(O:Object*,I:Hit Points*)</a></li>
            <li><a href="#triggers-4117">0x4118 HPLostGT(O:Object*,I:Hit Points*)</a></li>
            <li><a href="#triggers-4117">0x4119 HPLostLT(O:Object*,I:Hit Points*)</a></li>
            <li><a href="#triggers-411a">0x411A Assign(S:Statement*,I:Type*ArgType,I:Local*)</a></li>
            <li><a href="#triggers-411b">0x411B Eval(S:Expression*,I:Type*ArgType,I:Loc*)</a></li>
            <li><a href="#triggers-411c">0x411C E(I:Num1*,I:Num2*)</a></li>
            <li><a href="#triggers-411c">0x411D GT(I:Num1*,I:Num2*)</a></li>
            <li><a href="#triggers-411c">0x411E LT(I:Num1*,I:Num2*)</a></li>
            <li><a href="#triggers-411f">0x411F CheckStatBAND(O:Object*,I:Value*,I:StatNum*Stats)</a></li>
          </ul>
          <hr />
          <a name="triggers-4042" id="triggers-4042"></a><p><strong>0x4042 PartyHasItem(S:Item*)</strong><br />
          <i>TobEx optimises this trigger by greatly reducing the amount of overhead associated with checking bags</i></p>
          <hr />
          <a name="triggers-4044" id="triggers-4044"></a><p><strong>0x4044 CheckStat(O:Object*,I:Value*,I:StatNum*Stats)<br />
          0x4045 CheckStatGT(O:Object*,I:Value*,I:StatNum*Stats)<br />
          0x4046 CheckStatLT(O:Object*,I:Value*,I:StatNum*Stats)</strong><br />
          <i>TobEx makes no direct changes to these opcodes. However, TobEx expands STATS.IDS to support a variety of new scripting stats. Also refer to the <a href="#stats">Scripting Stats</a> section.</i><br />
          <hr />
          <a name="triggers-005d" id="triggers-005d"></a><p><strong>0x005D PickPocketFailed(O:Object*)</strong><br />
          <i>TobEx restores the function of this trigger such that it is sent when a pickpocket attempt fails. The standard AttackedBy() trigger is also sent as per vanilla behaviour. Also refer to the <a href="#actions-25">PickPockets(O:Target*)</a> action.</i></p>
          <p><strong>Option:</strong> TobEx gives the option of modifying the <a href="#actions-25">PickPockets(O:Target*)</a> action so that upon failure, it sends only the PickPocketFailed() trigger, and not sending the standard AttackedBy() trigger.</p>
          <hr />
          <a name="triggers-4061" id="triggers-4061"></a><p><strong>0x4061 HasItem(S:ResRef*,O:Object*)</strong><br />
          <i>TobEx optimises this trigger by greatly reducing the amount of overhead associated with checking bags</i></p>
          <hr />
          <a name="triggers-40a9" id="triggers-40a9"></a><p><strong>0x40A9 PartyHasItemIdentified(S:ResRef*)</strong><br />
          <i>TobEx optimises this trigger by greatly reducing the amount of overhead associated with checking bags. TobEx fixes a bug in single player where this trigger opcode behaved exactly the same as the PartyHasItem() trigger opcode.</i></p>
          <hr />
          <a name="triggers-40bb" id="triggers-40bb"></a><p><strong>0x40BB Kit(O:Object*,I:Kit*KIT)</strong><br />
          <i>TobEx fixes this trigger opcode so that the full dword of I:Kit is checked against the creature rather than just the low word. To preserve original behaviour, if an I:Kit value of 0 is used, only the low word is checked against.</i></p>
          <hr />
           <a name="triggers-4100" id="triggers-4100"></a><p><strong>0x4100 NextTriggerObject(O:Object*)</strong><br />
          <i>New</i><br />
          Defines the object that the next trigger will be evaluated in reference to. This trigger does not evaluate and does not count as a trigger in an OR() block. This trigger ignores the Eval() trigger when finding the next trigger to evaluate the object for. If the object cannot be found, the next trigger will evaluate to false.</p>
          <hr />
          <a name="triggers-4101" id="triggers-4101"></a><p><strong>0x4101 MovementRate(O:Object*,I:Value*)<br />
          0x4102 MovementRateGT(O:Object*,I:Value*)<br />
          0x4103 MovementRateLT(O:Object*,I:Value*)</strong><br />
          <i>New</i><br />
          Compares the animation movement rate of the target creature specified by Object to Value. This is not affected by slow or haste, but is affected if the Object is entangled, webbed, etc.</p>
          <hr />
          <a name="triggers-4104" id="triggers-4104"></a><p><strong>0x4104 NumMirrorImages(O:Object*,I:Value*)<br />
          0x4105 NumMirrorImagesGT(O:Object*,I:Value*)<br />
          0x4106 NumMirrorImagesLT(O:Object*,I:Value*)</strong><br />
          <i>New</i><br />
          Compares the number of mirror images present on the target creature specified by Object to Value.</p>
          <hr />
          <a name="triggers-4107" id="triggers-4107"></a><p><strong>0x4107 BouncingSpellLevel(O:Object*,I:Level*)</strong><br />
          <i>New</i><br />
          Returns true if the target creature specified by Object is bouncing spells of power Level.<br />
          This returns true for both Bounce Spell Level (199) and Decrementing Bounce Spells (200) effects.</p>
          <hr />
          <a name="triggers-4108" id="triggers-4108"></a><p><strong>0x4108 NumBouncingSpellLevel(O:Object*,I:Level*,I:Amount*)<br />
          0x4109 NumBouncingSpellLevelGT(O:Object*,I:Level*,I:Amount*)<br />
          0x410A NumBouncingSpellLevelLT(O:Object*,I:Level*,I:Amount*)</strong><br />
          <i>New</i><br />
          Compares the number of spell bounces remaining on the target creature specified by Object at the power Level to Amount. If Object has the Bounce Spell Level (199) opcode, then the number of spell bounces is unsigned 0xFFFFFFFF.</p>
          <hr />
          <a name="triggers-410b" id="triggers-410b"></a><p><strong>0x410B ImmuneToSpellLevel(O:Object*,I:Level*)</strong><br />
          <i>New</i><br />
          Returns true if the target creature specified by Object is protected from spells of power Level. This returns true for both Protection from Spell Levels (102) and Decrementing Spell Immunity (201) effects.</p>
          <hr />
          <a name="triggers-410c" id="triggers-410c"></a><p><strong>0x410C NumImmuneToSpellLevel(O:Object*,I:Level*,I:Amount*)<br />
          0x410D NumImmuneToSpellLevelGT(O:Object*,I:Level*,I:Amount*)<br />
          0x410E NumImmuneToSpellLevelLT(O:Object*,I:Level*,I:Amount*)</strong><br />
          <i>New</i><br />
          Compares the number of spell protections remaining on the target creature specified by Object at the power Level to Amount. If Object has the Protection from Spell Levels (102) opcode, then the number of spell protections is unsigned 0xFFFFFFFF.<br />
          <hr />
          <a name="triggers-410f" id="triggers-410f"></a><p><strong>0x410F TimeStopCounter(I:Number*)<br />
          0x4110 TimeStopCounterGT(I:Number*)<br />
          0x4111 TimeStopCounterLT(I:Number*)</strong><br />
          <i>New</i><br />
          Compares the number of ticks left of time stop to Number.</p>
          <hr />
          <a name="triggers-4112" id="triggers-4112"></a><p><strong>0x4112 TimeStopObject(O:Object*)</strong><br />
          <i>New</i><br />
          Returns true if the the target sprite specified by Object is the caster of time stop (and is exempt from the effect).</p>
          <hr />
          <a name="triggers-4113" id="triggers-4113"></a><p><strong>0x4113 NumTrappingSpellLevel(O:Object*,I:Level*,I:Amount*)<br />
          0x4114 NumTrappingSpellLevelGT(O:Object*,I:Level*,I:Amount*)<br />
          0x4115 NumTrappingSpellLevelLT(O:Object*,I:Level*,I:Amount*)</strong><br />
          <i>New</i><br />
          Compares the number of spell traps remaining on the target creature specified by Object at the power Level to Amount.</p>
          <hr />
          <a name="triggers-4116" id="triggers-4116"></a><p><strong>0x4116 OriginalClass(O:Object*,I:Class*Class)</strong><br />
          <i>New</i><br />
          Returns true if the target creature specified by Object is dual-classed and the original class matches Class.</p>
          <hr />
          <a name="triggers-4117" id="triggers-4117"></a><p><strong>0x4117 HPLost(O:Object*,I:Hit Points*)<br />
          0x4118 HPLostGT(O:Object*,I:Hit Points*)<br />
          0x4119 HPLostLT(O:Object*,I:Hit Points*)</strong><br />
          <i>New</i><br />
          Compares the absolute number of hit points short of maximum hit points on the target creature specified by Object to Amount.</p>
          <hr />
          <a name="triggers-411a" id="triggers-411a"></a><p><strong>0x411A Assign(S:Statement*,I:Type*ArgType,I:Local*)</strong><br />
          <i>New</i><br />
          Assigns a value determined by Statement of the type Type from ARGTYPE.IDS (INT integer, or STR string) to a local trigger block variable. The general form of Statement is "prefix[params]". This trigger does not evaluate and does not count as a trigger in an OR() block.</p>
          <ul>
            <li>"prefix" can be:</li>
            <table class="important">
              <tr>
                <td><strong>prefix</strong></td>
                <td><strong>description</strong></td>
                <td><strong>params type</strong></td>
                <td><strong>examples</strong></td>
              </tr>
              <tr>
                <td>c</td>
                <td>assigns a constant value</td>
                <td>integer or string</td>
                <td>c[1], c[FOO]</td>
              </tr>
              <tr>
                <td>e</td>
                <td>assigns the value of an expression</td>
                <td>expression (see trigger <a href="#triggers-411b">0x411B Eval()</a> for format)</td>
                <td>e[6 + 7]</td>
              </tr>
              <tr>
                <td>id</td>
                <td>assigns the index of a IDS file value</td>
                <td>file.value</td>
                <td>id[EA.CHARMED]</td>
              </tr>
              <tr>
                <td>s</td>
                <td>assigns the value of the stat specified of the current object</td>
                <td>STATS.IDS name</td>
                <td>s[LEVEL]</td>
              </tr>
              <tr>
                <td>sp</td>
                <td>assigns the value of the special value specified (of the current object, if applicable)</td>
                <td>ASGNSPEC.IDS name</td>
                <td>sp[SPRITE_PT_X]</td>
              </tr>
              <tr>
                <td>tn</td>
                <td>assigns the value of a 2DA file value by coordinates</td>
                <td>file.x.y</td>
                <td>tn[IMPORT01.0.0]</td>
              </tr>
              <tr>
                <td>ts</td>
                <td>assigns the value of a 2DA file value by column and row name</td>
                <td>file.column.row</td>
                <td>tn[IMPORT01.ITEMS.1]</td>
              </tr>
              <tr>
                <td>v</td>
                <td>assigns the value of a variable</td>
                <td>name.scope</td>
                <td>v[foo.GLOBAL]</td>
              </tr>
            </table>
            <li>"params" values containing #&ltnum&gt and @&ltnum&gt are replaced by the integer and string values, respectively, stored in local trigger block variables of index "num". Avoid using integer variables in expressions of string type. Avoid using string variables in expressions of integer type. The range of "num" is 0 to 24.</li>
          </ul>
          <hr />
          <a name="triggers-411b" id="triggers-411b"></a><p><strong>0x411B Eval(S:Expression*,I:Type*ArgType,I:Loc*)</strong><br />
          <i>New</i><br />
          Overwrites the (Loc)th argument of type Type from ARGTYPE.IDS (INT integer, or STR string) in the next trigger with the value returned by Expression. This trigger does not evaluate and does not count as a trigger in an OR() block. This trigger does not overwrite values of the Assign(), NextTriggerObject() and OR() triggers. The NextTriggerObject() trigger ignores this trigger.</p>
          <ul>
            <li>Expression is a math expression that can use the following symbols:</li>
              <p>= + - * / % ^ ( )</p>
              <p>min(x, y), max(x, y), avg(x, y)</p>
              <p>ceil(x), floor(x), round(x)</p>
              <p>abs(x)</p>
              <p>reciprocal(x)</p>
              <p>sqrt(x), pow(x, y)</p>
              <p>log(x), log10(x)</p>
              <p>sin(x), cos(x), tan(x), sinh(x), cosh(x), tanh(x), asin(x), acos(x), atan(x), atan2(x)</p>
              <p>Custom: and(x, y), or(x, y), band(x, y), bor(x, y)</p>
            <li>Any text in Expression of form #&ltnum&gt and @&ltnum&gt is replaced by the integer and string values, respectively, stored in local trigger block variables of index "num". Avoid using integer variables in expressions of string type. Avoid using string variables in expressions of integer type. The range of "num" is 0 to 24.</li>
          </ul>
          <hr />
          <a name="triggers-411c" id="triggers-411c"></a><p><strong>0x411C E(I:Num1*,I:Num2*)<br />
          0x411D GT(I:Num1*,I:Num2*)<br />
          0x411E LT(I:Num1*,I:Num2*)</strong><br />
          <i>New</i><br />
          Compares "Num1" to "Num2", where E is equals, GT is greater than, and LT is less than. To make use of these triggers, the <a href="#triggers-411b">0x411B Eval()</a> trigger should be used prior to this trigger.</p>
          <hr />
          <a name="triggers-411f" id="triggers-411f"></a><p><strong>0x411F CheckStatBAND(O:Object*,I:Value*,I:StatNum*Stats)</strong><br />
          <i>New</i><br />
          Returns true only if the specified object has the statistic in the 3rd parameter produces a non-zero value when executing a bitwise AND with the value of the 2nd parameter.</p>
          <address>
            <span class="footer">TobEx &gt; Triggers</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== A c t i o n s ================== -->
        <a name="actions" id="actions"></a>
        <div class="content">
          <h2>Actions</h2>
          <p>TobEx makes changes to the following script action opcodes:</p>
          <ul>
            <li><a href="#actions-19">19 JoinParty()</a></li>
            <li><a href="#actions-25">25 PickPockets(O:Target*)</a></li>
            <li><a href="#actions-34">34 UseItem(S:Object*,O:Target*)</a></li>
            <li><a href="#actions-97">97 UseItemPoint(S:Item,P:Target*,I:Ability*)</a></li>
            <li><a href="#actions-116">116 TakePartyItem(S:Item*)</a></li>
            <li><a href="#actions-174">174 EquipRanged()</a></li>
            <li><a href="#actions-188">188 TakePartyItemAll(S:Item*)</a></li>
            <li><a href="#actions-193">193 TakePartyItemRange(S:Item*)</a></li>
            <li><a href="#actions-194">194 ChangeAnimation(S:ResRef*)</a></li>
            <li><a href="#actions-204">204 TakePartyItemNum(S:ResRef*,I:Num*)</a></li>
            <li><a href="#actions-219">219 ChangeAnimationNoEffect(S:ResRef*)</a></li>
            <li><a href="#actions-220">220 TakeItemListParty(S:ResRef*)</a></li>
            <li><a href="#actions-226">226 TakeItemListPartyNum(S:ResRef*,I:Num*)</a></li>
            <li><a href="#actions-274">274 AddKit(I:Kit*KIT)</a></li>
            <li><a href="#actions-289">289 AddSuperKit(I:Kit*KIT)</a></li>
            <li><a href="#actions-317">317 PlaySong(I:Song*)</a></li>
          </ul>
          <p>TobEx adds the following new script action opcodes:</p>
          <ul>
            <li><a href="#actions-352">352 LoseGame()</a></li>
            <li><a href="#actions-353">353 DialogueSetGlobal(S:Name*,S:Area*,I:Value*)</a></li>
            <li><a href="#actions-354">354 DialogueIncrementGlobal(S:Name*,S:Area*,I:Value*)</a></li>
            <li><a href="#actions-355">355 DialogueSG(S:Name*,I:Num*)</a></li>
            <li><a href="#actions-356">356 Assign(S:Statement*,I:Type*ArgType,I:Local*)</a></li>
            <li><a href="#actions-356">356 AssignFromObject(S:Statement*,O:Object*,I:Type*ArgType,I:Local*)</a></li>
            <li><a href="#actions-357">357 Eval(S:Expression*,I:Type*ArgType,I:Loc*)</a></li>
            <li><a href="#actions-358">358 ClearBlockVariables()</a></li>
          </ul>
          <hr />
          <a name="actions-19" id="actions-19"></a><p><strong>19 JoinParty()</strong><br />
          <i>TobEx fixes this action opcode to prevent the action restoring all class abilities, which would allow players to re-use class abilities over and over again.</i></p>
          <hr />
          <a name="actions-25" id="actions-25"></a><p><strong>25 PickPockets(O:Target*)</strong><br />
          <p>TobEx extends this action opcode by sending the PickPocketFailed() trigger in addition to the standard AttackedBy() trigger when a pickpocket attempt fails. Also refer to the <a href="#triggers-005d">PickPocketFailed() trigger</a> section.</p>
          <p><strong>Option:</strong> TobEx gives the option of modifying this action so that upon failure, it sends only the PickPocketFailed() trigger, and not sending the standard AttackedBy() trigger.</p>
          <p><strong>Option:</strong> TobEx gives the option of modifying this action by delaying the end of Stealth mode until the next round, and not terminating invisibility caused by a spell or item, if a successful pickpocket is made.</p>
          <hr />
          <a name="actions-34" id="actions-34"></a><p><strong>34 UseItem(S:Object*,O:Target*)</strong><br />
          <i>TobEx modifies this action opcode indirectly by allowing custom animation sequences to be played on the creature using the item. This is controlled by ITEMANIM.2DA and is item ability-specific. Also refer to the <a href="#animations-using-items">Animation Sequences when Using Items</a> section.</i></p>
          <hr />
          <a name="actions-97" id="actions-97"></a><p><strong>97 UseItemPoint(S:Item,P:Target*,I:Ability*)</strong><br />
          <i>TobEx modifies this action opcode indirectly by allowing custom animation sequences to be played on the creature using the item. This is controlled by ITEMANIM.2DA and is item ability-specific. Also refer to the <a href="#animations-using-items">Animation Sequences when Using Items</a> section.</i></p>
          <hr />
          <a name="actions-116" id="actions-116"></a><p><strong>116 TakePartyItem(S:Item*)</strong><br />
          <i>TobEx fixes this action opcode so that non-party characters taking items no longer put them in the magical weapon slot or quick item slots. TobEx also removes a buffer overflow in some cases when putting items into the magical weapon slot.</i></p>
          <hr />
          <a name="actions-174" id="actions-174"></a><p><strong>174 EquipRanged()</strong><br />
          <i>TobEx fixes this action opcode so that one-handed ranged weapons are equipped with this action when a shield is currently equipped</i></p>
          <hr />
          <a name="actions-188" id="actions-188"></a><p><strong>188 TakePartyItemAll(S:Item*)</strong><br />
          <i>TobEx fixes this action opcode so that non-party characters taking items no longer put them in the magical weapon slot or quick item slots. TobEx also removes a buffer overflow in some cases when putting items into the magical weapon slot.</i></p>
          <hr />
          <a name="actions-193" id="actions-193"></a><p><strong>193 TakePartyItemRange(S:Item*)</strong><br />
          <i>TobEx fixes this action opcode so that non-party characters taking items no longer put them in the magical weapon slot or quick item slots. TobEx also removes a buffer overflow in some cases when putting items into the magical weapon slot.</i></p>
          <hr />
          <a name="actions-194" id="actions-194"></a><p><strong>194 ChangeAnimation(S:ResRef*)</strong><br />
          <i>TobEx fixes a bug with this action opcode where a creature killed during this action does not die correctly, resulting in an invincible creature with zero hit points.</i></p>
          <hr />
          <a name="actions-204" id="actions-204"></a><p><strong>204 TakePartyItemNum(S:ResRef*,I:Num*)</strong><br />
          <i>TobEx fixes this action opcode so that non-party characters taking items no longer put them in the magical weapon slot or quick item slots. TobEx also removes a buffer overflow in some cases when putting items into the magical weapon slot.</i></p>
          <hr />
          <a name="actions-220" id="actions-220"></a><p><strong>220 TakeItemListParty(S:ResRef*)</strong><br />
          <i>TobEx fixes this action opcode so that non-party characters taking items no longer put them in the magical weapon slot or quick item slots. TobEx also removes a buffer overflow in some cases when putting items into the magical weapon slot.</i></p>
          <hr />
          <a name="actions-226" id="actions-226"></a><p><strong>226 TakeItemListPartyNum(S:ResRef*,I:Num*)</strong><br />
          <i>TobEx fixes this action opcode so that non-party characters taking items no longer put them in the magical weapon slot or quick item slots. TobEx also removes a buffer overflow in some cases when putting items into the magical weapon slot.</i></p>
          <hr />
          <a name="actions-219" id="actions-219"></a><p><strong>219 ChangeAnimationNoEffect(S:ResRef*)</strong><br />
          <i>TobEx fixes a bug with this action opcode where a creature killed during this action does not die correctly, resulting in an invincible creature with zero hit points.</i></p>
          <hr />
          <a name="actions-274" id="actions-274"></a><p><strong>274 AddKit(I:Kit*KIT)</strong><br />
          <i>Fixed so the full dword of I:Kit is saved into the creature rather than the low word. This specifically allows setting BARBARIAN (0x40000000) and WILDMAGE (0x80000000) kits.</i></p>
          <hr />
          <a name="actions-289" id="actions-289"></a><p><strong>289 AddSuperKit(I:Kit*KIT)</strong><br />
          <i>Fixed so the full dword of I:Kit is saved into the creature rather than the low word. This specifically allows setting BARBARIAN (0x40000000) and WILDMAGE (0x80000000) kits.</i></p>
          <hr />
          <a name="actions-317" id="actions-317"></a><p><strong>317 PlaySong(I:Song*)</strong><br />
          <i>TobEx modifies this action opcode to allow songs with index greater than 127 to be played, allowing modmakers to fully utilise an extended SONGLIST.2DA. Also refer to the <a href="#engine-music">Music Song List</a> section.</i></p>
          <hr />
          <a name="actions-352" id="actions-352"></a><p><strong>352 LoseGame()</strong><br />
          <i>New</i><br />
          Plays the ending cutscene as if the protagonist died. If the action is used in a pausing dialogue, the ending cutscene will play after the dialogue ends. This action does nothing in the arenas game type.</p>
          <hr />
          <a name="actions-353" id="actions-353"></a><p><strong>353 DialogueSetGlobal(S:Name*,S:Area*,I:Value*)</strong><br />
          <i>New</i><br />
          Sets the variable 'Name' in the scope 'Area' to 'Value' immediately instead of being added through the dialogue owner's action queue. This allows variables to be set instantaneously and checked immediately afterwards in the same dialogue. ActionOverride() is supported. If used outside dialogue, this action behaves exactly as SetGlobal().<br />
          <br />
          Limitations: Variables become set asynchronously to the order in which the action is present on the script block. This can cause issues when an action is purposely sandwiched between two modifications of the same variable.</p>
          <hr />
          <a name="actions-354" id="actions-354"></a><p><strong>354 DialogueIncrementGlobal(S:Name*,S:Area*,I:Value*)</strong><br />
          <i>New</i><br />
          Increments the variable 'Name' in the scope 'Area' by 'Value' immediately instead of being added through the dialogue owner's action queue. This allows variables to be set instantaneously and checked immediately afterwards in the same dialogue. ActionOverride() is supported. If used outside dialogue, this action behaves exactly as IncrementGlobal().<br />
          <br />
          Limitations: Variables become set asynchronously to the order in which the action is present on the script block. This can cause issues when an action is purposely sandwiched between two modifications of the same variable.</p>
          <hr />
          <a name="actions-355" id="actions-355"></a><p><strong>355 DialogueSG(S:Name*,I:Num*)</strong><br />
          <i>New</i><br />
          Sets the global variable 'Name' to 'Num' immediately instead of being added through the dialogue owner's action queue. This allows variables to be set instantaneously and checked immediately afterwards in the same dialogue. ActionOverride() is supported. If used outside dialogue, this action behaves exactly as SG().<br />
          <br />
          Limitations: Variables become set asynchronously to the order in which the action is present on the script block. This can cause issues when an action is purposely sandwiched between two modifications of the same variable.</p>
          <hr />
          <a name="actions-356" id="actions-356"></a><p><strong>356 Assign(S:Statement*,I:Type*ArgType,I:Local*)<br />
          356 AssignFromObject(S:Statement*,O:Object*,I:Type*ArgType,I:Local*)</strong><br />
          <i>New</i><br />
          Assigns a value determined by Statement of the type Type from ARGTYPE.IDS (INT integer, or STR string) to a local action block variable. The general form of Statement is "prefix[params]". If Object is specified, the value of Statement is determined relative to Object instead of the object that owns the script. This action is ignored by prior Eval() actions.</p>
          <ul>
            <li>"prefix" can be:</li>
            <table class="important">
              <tr>
                <td><strong>prefix</strong></td>
                <td><strong>description</strong></td>
                <td><strong>params type</strong></td>
                <td><strong>examples</strong></td>
              </tr>
              <tr>
                <td>c</td>
                <td>assigns a constant value</td>
                <td>integer or string</td>
                <td>c[1], c[FOO]</td>
              </tr>
              <tr>
                <td>e</td>
                <td>assigns the value of an expression</td>
                <td>expression (see action <a href="#actions-357">0x411B Eval()</a> for format)</td>
                <td>e[6 + 7]</td>
              </tr>
              <tr>
                <td>id</td>
                <td>assigns the index of a IDS file value</td>
                <td>file.value</td>
                <td>id[EA.CHARMED]</td>
              </tr>
              <tr>
                <td>s</td>
                <td>assigns the value of the stat specified of the current object</td>
                <td>STATS.IDS name</td>
                <td>s[LEVEL]</td>
              </tr>
              <tr>
                <td>sp</td>
                <td>assigns the value of the special value specified (of the current object, if applicable)</td>
                <td>ASGNSPEC.IDS name</td>
                <td>sp[SPRITE_PT_X]</td>
              </tr>
              <tr>
                <td>tn</td>
                <td>assigns the value of a 2DA file value by coordinates</td>
                <td>file.x.y</td>
                <td>tn[IMPORT01.0.0]</td>
              </tr>
              <tr>
                <td>ts</td>
                <td>assigns the value of a 2DA file value by column and row name</td>
                <td>file.column.row</td>
                <td>tn[IMPORT01.ITEMS.1]</td>
              </tr>
              <tr>
                <td>v</td>
                <td>assigns the value of a variable</td>
                <td>name.scope</td>
                <td>v[foo.GLOBAL]</td>
              </tr>
            </table>
            <li>"params" values containing #&ltnum&gt and @&ltnum&gt are replaced by the integer and string values, respectively, stored in local action block variables of index "num". Avoid using integer variables in expressions of string type. Avoid using string variables in expressions of integer type. The range of "num" is 0 to 24.</li>
          </ul>
          <hr />
          <a name="actions-357" id="actions-357"></a><p><strong>357 Eval(S:Expression*,I:Type*ArgType,I:Loc*)</strong><br />
          <i>New</i><br />
          Overwrites the (Loc)th argument of type Type from ARGTYPE.IDS (INT integer, or STR string) in the next action with the value returned by Expression. To replace point X and point Y, use a Loc value of 4 and 5, respectively. This action skips subsequent Assign() and Eval() actions when determining in which action to overwrite a value. This action does not overwrite values of actions beyond ClearBlockVariables() actions.</p>
          <ul>
            <li>Expression is a math expression that can use the following symbols:</li>
              <p>= + - * / % ^ ( )</p>
              <p>min(x, y), max(x, y), avg(x, y)</p>
              <p>ceil(x), floor(x), round(x)</p>
              <p>abs(x)</p>
              <p>reciprocal(x)</p>
              <p>sqrt(x), pow(x, y)</p>
              <p>log(x), log10(x)</p>
              <p>sin(x), cos(x), tan(x), sinh(x), cosh(x), tanh(x), asin(x), acos(x), atan(x), atan2(x)</p>
              <p>Custom: and(x, y), or(x, y), band(x, y), bor(x, y)</p>
            <li>Any text in Expression of form #&ltnum&gt and @&ltnum&gt is replaced by the integer and string values, respectively, stored in local action block variables of index "num". Avoid using integer variables in expressions of string type. Avoid using string variables in expressions of integer type. The range of "num" is 0 to 24.</li>
          </ul>
          <hr />
          <a name="actions-358" id="actions-358"></a><p><strong>358 ClearBlockVariables()</strong><br />
          <i>New</i><br />
          Sets all action block integer variables to 0 and empties all actions block string variables.</p>
          <address>
            <span class="footer">TobEx &gt; Actions</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== S t a t s ================== -->
        <a name="stats" id="stats"></a>
        <div class="content">
          <h2>Scripting Stats</h2>
          <p>TobEx expands the use of STATS.IDS to support new hard-coded stats and custom stats for modmaker use. The features of new stats are:<br />
          <ul>
            <li>New stats can be set using effect opcode 318 (0x13E) with description below</li>
            <li>New stats 202-400 are reserved for hard-coded stats</li>
            <li>New stats can be checked correctly using CheckStat(), CheckStatLT(), and CheckStatGT() script triggers</li>
            <li>New stats are not permanent, they require an ongoing effect opcode 318 in order to keep their values</li>
            <li>New stats will only be saved in saved games if stored as an effect opcode 318</li>
            <li>Actions cannot directly set the value of new stats (they will not keep); use an action to trigger effect opcode 318 if actions are required</li>
            <li>New stats have no effect on the game unless you specifically script in; for example, use scripts to CheckStat() and apply appropriate actions</li>
          </ul>
          <p>New hard-coded stats that cannot be set using effect opcode 318 include:</p>
          <table class="important">
            <tr>
              <td>301 FIGHTERLEVEL</td>
              <td>true fighter level (does not include monk)</td>
            </tr>
            <tr>
              <td>302 MAGELEVEL</td>
              <td>true mage level (does not include sorcerer)</td>
            </tr>
            <tr>
              <td>303 CLERICLEVEL</td>
              <td>true cleric level</td>
            </tr>
            <tr>
              <td>304 THIEFLEVEL</td>
              <td>true thief level</td>
            </tr>
            <tr>
              <td>305 DRUIDLEVEL</td>
              <td>true druid level</td>
            </tr>
            <tr>
              <td>306 RANGERLEVEL</td>
              <td>true ranger level</td>
            </tr>
            <tr>
              <td>307 EFFECTCLERICLEVEL</td>
              <td>equivalent cleric casting level (Cleric 1 = Ranger 8 = Paladin 9; Cleric-Rangers use cleric level)</td>
            </tr>
            <tr>
              <td>308 BUTTONDISABLESTEALTH</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>309 BUTTONDISABLETHIEVING</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>310 BUTTONDISABLECASTSPELL</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>311 BUTTONDISABLEQUICKSPELL1</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>312 BUTTONDISABLEQUICKSPELL2</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>313 BUTTONDISABLEQUICKSPELL3</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>314 BUTTONDISABLETURNUNDEAD</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>315 BUTTONDISABLETALK</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>316 BUTTONDISABLEUSEITEM</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>317 BUTTONDISABLEQUICKITEM1</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>318 BUTTONDISABLEBARDSONG</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>319 BUTTONDISABLEQUICKITEM2</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>320 BUTTONDISABLEQUICKITEM3</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>321 BUTTONDISABLEABILITY</td>
              <td>set via Disable/Enable Button effect opcodes</td>
            </tr>
            <tr>
              <td>322 BUTTONDISABLEFINDTRAPS</td>
              <td>set via Disable/Enable Button effect opcodes, disables Find Traps button when set to 1</td>
            </tr>
            <tr>
              <td>323 AID</td>
              <td>set to param1 of Aid effect</td>
            </tr>
            <tr>
              <td>324 BLESS</td>
              <td>set to param1 of Bless effect</td>
            </tr>
            <tr>
              <td>325 CHANT</td>
              <td>set to param1 of Chant effect</td>
            </tr>
            <tr>
              <td>326 DRAWUPONHOLYMIGHT</td>
              <td>set to param1 of Draw Upon Holy Might effect</td>
            </tr>
            <tr>
              <td>327 CHANTBAD</td>
              <td>set to param1 of Chant Bad effect</td>
            </tr>
            <tr>
              <td>328 DISABLESPELLTYPEWIZARD</td>
              <td>set to 1 on Disable Spelltype effect</td>
            </tr>
            <tr>
              <td>329 DISABLESPELLTYPEPRIEST</td>
              <td>set to 1 on Disable Spelltype effect</td>
            </tr>
            <tr>
              <td>330 DISABLESPELLTYPEINNATE</td>
              <td>set to 1 on Disable Spelltype effect</td>
            </tr>
            <tr>
              <td>331 WINGBUFFET</td>
              <td>set to param2 of Wing Buffet effect</td>
            </tr>
          </table>
          <p>New hard-coded stats that can be set using effect opcode 318 include:</p>
          <table class="important">
            <tr>
              <td>387 ACIDDAMAGEBONUS</td>
              <td>percentage modifier to acid damage from item/spell ability effects</td>
            </tr>
            <tr>
              <td>388 COLDDAMAGEBONUS</td>
              <td>percentage modifier to cold damage from item/spell ability effects</td>
            </tr>
            <tr>
              <td>389 CRUSHINGDAMAGEBONUS</td>
              <td>percentage modifier to crushing damage from normal damage and item/spell ability effects</td>
            </tr>
            <tr>
              <td>390 ELECTRICITYDAMAGEBONUS</td>
              <td>percentage modifier to electricity damage from item/spell ability effects</td>
            </tr>
            <tr>
              <td>391 FIREDAMAGEBONUS</td>
              <td>percentage modifier to fire damage from item/spell ability effects</td>
            </tr>
            <tr>
              <td>392 PIERCINGDAMAGEBONUS</td>
              <td>percentage modifier to piercing damage from normal damage and item/spell ability effects</td>
            </tr>
            <tr>
              <td>393 POISONDAMAGEBONUS</td>
              <td>percentage modifier to poison damage from item/spell ability effects</td>
            </tr>
            <tr>
              <td>394 MAGICDAMAGEBONUS</td>
              <td>percentage modifier to magic damage from item/spell ability effects</td>
            </tr>
            <tr>
              <td>395 MISSILEDAMAGEBONUS</td>
              <td>percentage modifier to missile damage from normal damage and item/spell ability effects</td>
            </tr>
            <tr>
              <td>396 SLASHINGDAMAGEBONUS</td>
              <td>percentage modifier to slashing damage from normal damage and item/spell ability effects</td>
            </tr>
            <tr>
              <td>397 MAGICFIREDAMAGEBONUS</td>
              <td>percentage modifier to magic fire damage from item/spell ability effects</td>
            </tr>
            <tr>
              <td>398 MAGICCOLDDAMAGEBONUS</td>
              <td>percentage modifier to magic colddamage from item/spell ability effects</td>
            </tr>
            <tr>
              <td>399 STUNNINGDAMAGEBONUS</td>
              <td>percentage modifier to stunning damage from normal damage and item/spell ability effects</td>
            </tr>
            <tr>
              <td>400 WEIGHTALLOWANCEMOD</td>
              <td>custom stat that modiifies by sum the amount a character is allowed to carry<br />
              (total weight allowance = StrMod value + StrModEx value + WeightAllowanceMod)</td>
            </tr>
          </table>

          <address>
            <span class="footer">TobEx &gt; Scripting Stats</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== A u d i o ================== -->
        <a name="audio" id="audio"></a>
        <div class="content">
          <h2>Audio</h2>
          <p>The following changes to audio are discussed:</p>
          <ul>
            <li><a href="#audio-animation-soundsets">Animation and Creature Soundsets</a></li>
            <li><a href="#audio-animation-walking">Animation Walking Sounds</a></li>
            <li><a href="#audio-dialogue-greeting">Dialogue Greeting Subtitles</a></li>
            <li><a href="#audio-soundset-subtitles">Soundset Subtitles</a></li>
          </ul>
          <hr />
          <a name="audio-animation-soundsets" id="audio-animation-soundsets"></a><h3>Animation and Creature Soundsets</h3>
          <p>TobEx fixes a bug that prevented the sounds in the middle of animation soundset 2DA files from playing. TobEx also fixes a bug where PICKED_POCKET sounds were played when EXISTANCE sounds were called for in the creature soundset. This was corrected to EXISTANCE5.</p>
          <p><strong>Option:</strong> TobEx gives the option to enable the use of SLASH, BACKSLASH, and JAB sounds in animation soundset 2DA files. These sounds play when the appropriate attack animation is played. They are played in addition to the ATTACK sound.</p>
          <hr />
          <a name="audio-animation-walking" id="audio-animation-walking"></a><h3>Animation Walking Sounds</h3>
          <p>TobEx externalises all animation walking sounds to ANIWKSND.2DA, which allows modmakers to specify custom walking sounds by each animation ID. This is particularly useful for new animations introduced by Infinity Animations.</p>
          <div class="important">
            <p>ANIWKSND.2DA<br />
            <br />
            [ROWNAME]: animation ID<br />
            ANIMATION: the name of the animation for your reference (from ANIMATE.IDS)<br />
            WALK_SOUND: 6-character string specifying the root name of the walking sound. Longer strings are read truncated. Shorter strings cause havoc! A value of '*' is equivalent to no walking sound.<br />
            WALK_NUM: integer specifying the number of walking sounds available for the root name.<br />
            <br />
            As per engine behaviour, a sound file will be loaded with name &lt;WALK_SOUND&gt;&lt;random&gt;, where &lt;random&gt; is mapped 0 -> a, 1 -> b, 2 -> c, ..., (WALK_NUM - 1) -> nul.<br />
            <br />
            Example</p>
            <table class="important">
              <tr>
                <td></td>
                <td>WALK_SOUND</td>
                <td>WALK_NUM</td>
              </tr>
              <tr>
                <td>0x1234</td>
                <td>WAL_20</td>
                <td>4</td>
              </tr>
            </table>
            <p>Walking sound for animation ID 0x1234 loads one of the following sounds:<br />
            WAL_20a [0]<br />
            WAL_20b [1]<br />
            WAL_20c [2]<br />
            WAL_20  [3]<br />
            <br />
            If WALK_SOUND is set to 'TERRAIN' and WALK_NUM is set to '*', ANITNSND.2DA is used to determine the walking sound.</p>
            <p>ANITNSND.2DA<br />
            <br />
            [ROWNAME]: terrain code, based on search map pixel<br />
            WALK_SOUND: as ANIWKSND.2DA above<br />
            WALK_NUM: as per ANIWKSND.2DA above</p>
          </div>
          <hr />
          <a name="audio-dialogue-greeting" id="audio-dialogue-greeting"></a><h3>Dialogue Greeting Subtitles</h3>
          <p><strong>Option:</strong> TobEx gives the option of displaying the greeting string reference in the dialogue bar when initiating dialogue, similar to Baldur's Gate I behaviour. However, the string is displayed after the first line of dialogue rather than before.</p>
          <hr />
          <a name="audio-soundset-subtitles" id="audio-soundset-subtitles"></a><h3>Soundset Subtitles</h3>
          <p>TobEx enables the display of subtitles for custom soundsets in the dialogue bar. This is achieved by appending by column to CSOUND.2DA. This is vanilla-compatible: if no column is present in CSOUND.2DA, no subtitles are used. To use this hack, use APPEND_COL on CSOUND.2DA. The column header should contain the prefix of the soundset (e.g. FEMALE1). The values for each sound should point to the string reference to display for the sound with suffix designated by the existing LETTER column. Please note the LETTER values in rows labelled with the numbers 30, 31, 39, 63, and 64 are incorrect in vanilla Throne of Bhaal and should be corrected to "x, y, *, _, *", respectively.</p>
          <address>
            <span class="footer">TobEx &gt; Audio</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== A n i m a t i o n s ================== -->
        <a name="animations" id="animations"></a>
        <div class="content">
          <h2>Animations and Graphics</h2>
          <p>The following animation changes are discussed:</p>
          <ul>
            <li><a href="#animations-using-items">Animation Sequences when Using Items</a></li>
            <li><a href="#animations-iwd">Icewind Dale-style Animations</a></li>
            <li><a href="#animations-paper-dolls">Paper Dolls</a></li>
            <li><a href="#animations-spell-turning">Spell Turning Animations</a></li>
            <li><a href="#animations-throwing-weapons">Throwing Weapon Animations</a></li>
            <li><a href="#animations-tooltip">Tooltip Scroll</a></li>
            <li><a href="#animations-vvc">Visual Effect Video Cells (VVCs)</a></li>
          </ul>
          <hr />
          <a name="animations-using-items" id="animations-using-items"></a><h3>Animation Sequences when Using Items</h3>
          <p>TobEx expands the use of custom animation sequences when using different abilities of the same item in the setting of the UseItem() and UseItemPoint() actions, or equivalent thereof (i.e. used as quick item). This is achieved by expanding ITEMANIM.2DA. Modmakers can therefore assign custom animation sequences to the use of specific item abilities.</p>
          <div class="important">
            <p>ITEMANIM.2DA<br />
            This file lists the character animation sequence to be played when an item ability is used. This only applies to items that are used in UseItem() and UseItemPoint() actions, or equivalent thereof (i.e. used as quick item).<br />
            <br />
            [ROWNAME]: Item ResRef<br />
            SEQUENCE: The animation sequence to play for the first ability of the specified item (from seq.ids). If there are no other columns, this is the animation sequence to play for all abilities.<br />
            &lt;subsequent columns&gt;: The animation sequence to play for the (n+1)th ability of the specified item (from seq.ids), where n is the name of the column.</p>
            <p>Example<br />
            WAND05.ITM has two abilities</p>
            <table class="important">
              <tr>
                <td>2DA V1.0</td>
              </tr>
              <tr>
                <td>-1</td>
              </tr>
              <tr>
                <td></td>
                <td>SEQUENCE</td>
                <td>1</td>
              </tr>
              <tr>
                <td>WAND05</td>
                <td>-1</td>
                <td>12</td>
              </tr>
            </table>
            <p>Using the first ability plays no animation sequence (-1). Using the second ability plays animation sequence 12 (SEQ_ATTACK_BACKSLASH).</p>
          </div>
          <hr />
          <a name="animations-iwd" id="animations-iwd"></a><h3>Icewind Dale-style Animations</h3>
          <p>TobEx fixed Icewind Dale-style animations (of IDs 0xE***) that use the 3rd attack animation (A3). These would otherwise have display the 2nd attack animation in northeast and east orientations if 'Sprite Mirror' is disabled in baldur.ini.</p>
          <hr />
          <a name="animations-paper-dolls" id="animations-paper-dolls"></a><h3>Paper Dolls</h3>
          <p>TobEx enables paperdolls to be shown in the inventory and character customisation screens for animation IDs 0x12XX, 0x2XXX, 0x3XXX, and modification-added 0x7XXX (except 0x73XX, which is already shown in vanilla), which would otherwise not show at all. Note that paperdolls for the 0x7XXX group of animation must have to be named &lt;prefix&gt;INV.BAM.</p>
          <hr />
          <a name="animations-spell-turning" id="animations-spell-turning"></a><h3>Spell Turning Animation</h3>
          <p>TobEx fixes a bug introduced somewhere between builds 22941 and 23037 of Shadows of Amn, whereby SPSTURNI.VVC was no longer played each time a spell is bounced off a creature who had spell turning.</p>
          <hr />
          <a name="animations-throwing-weapons" id="animations-throwing-weapons"></a><h3>Throwing Weapon Animations</h3>
          <p><strong>Option:</strong> TobEx gives the option of enabling the use of item ability slash %, backslash %, and jab % fields for ranged weapons equipped in a weapon slot that do not require a launcher. Because this hack makes the creature use of the SEQ_ATTACK_[] animations instead of SEQ_SHOOT, attacks play the SEQ_ATTACK and SEQ_ATTACK_[] animation sounds instead of the SEQ_SHOOT animation sound. These percentages will only affect creatures with animation IDs in the 0x5000-0x53FF group with animation prefix starting with C, and 0x6*** groups to maintain vanilla behaviour and Infinity Animations compatibility.</p>
          <hr />
          <a name="animations-tooltip" id="animations-tooltip"></a><h3>Tooltip Scroll</h3>
          <p>TobEx enlarges the tooltip scroll so that it can fit more text.</p>
          <hr />
          <a name="animations-vvc" id="animations-vvc"></a><h3>Visual Effect Video Cells (VVCs)</h3>
          <p>TobEx fixes a few issues with the VVC file format.</p>
          <p>The Display Flag (0x0018) bit 2 (Translucent shadow) has been fixed to use the Shadow Animation ResRef (0x0010) instead of duplicating the use of the Primary Animation ResRef (0x0008).</p>
          <p>The Alpha Blending Animation ResRef (0x0088) has been fixed to allow its use without summarily causing an assertion failure.</p>
          <address>
            <span class="footer">TobEx &gt; Animations and Graphics</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>


        <!-- ================== E f f e c t s ================== -->
        <a name="effects" id="effects"></a>
        <div class="content">
          <h2>Effects</h2>
          <p>TobEx makes the following changes to the EFF V2.0 file format.</p>
          <h3>Body</h3>
          <table class="important" border="1">
            <tr>
              <td>Offset</td>
              <td>Description</td>
            </tr>
            <tr>
              <td>0x0040 (dword)</td>
              <td>
                <p>Saving throw type</p>
                <ul>
                  <li>bit 24: <a href="#effects-12">bypass mirror images</a></li>
                  <li>bit 25: <a href="#engine-effect-stacking">limit effect stacking</a></li>
                  <li>bit 26: <a href="#engine-effect-stacking">internal: suspend effect application</a></li>
                </ul>
              </td>
            </tr>
            <tr>
              <td>0x0048 (dword)</td>
              <td>
                <p>Special</p>
                <ul>
                  <li>Vanilla: Used only for Set Local Variable when the variable is non-existant</li>
                  <li><a href="#engine-effect-stacking">Stacking ID</a> when bit 25 of 'Saving throw type' is enabled</li>
                </ul>
              </td>
            </tr>
          </table>
          <hr />
          <p>TobEx makes changes to the following effect opcodes:</p>
          <ul>
            <li><a href="#effects-1">#1 (0x001)  Stat: Attacks Per Round Modifier [1]</a></li>
            <li><a href="#effects-2">#2 (0x002)  Cure: Sleep [2]</a></li>
            <li><a href="#effects-6">#6 (0x006) Stat: Charisma Modifier [6]</a></li>
            <li><a href="#effects-10">#10 (0x00A) Stat: Constitution Modifier [10]</a></li>
            <li><a href="#effects-12">#12 (0x00C)  HP: Damage [12]</a></li>
            <li><a href="#effects-13">#13 (0x00D)  Death: Instant Death [13]</a></li>
            <li><a href="#effects-15">#15 (0x00F)  Stat: Dexterity Modifier [15]</a></li>
            <li><a href="#effects-19">#19 (0x013) Stat: Intelligence Modifier [19]</a></li>
            <li><a href="#effects-20">#20 (0x014)  State: Invisibility [20]</a></li>
            <li><a href="#effects-21">#21 (0x015) Stat: Lore Modifier [21]</a></li>
            <li><a href="#effects-22">#22 (0x016)  Stat: Cumulative Luck Bonus [22]</a></li>
            <li><a href="#effects-25">#25 (0x019)  State: Poison [25]</a></li>
            <li><a href="#effects-33">#33 (0x021)  Stat: Save vs. Death Modifier [33]</a></li>
            <li><a href="#effects-34">#34 (0x022)  Stat: Save vs. Wands Modifier [34]</a></li>
            <li><a href="#effects-35">#35 (0x023)  Stat: Save vs. Petrification/Polymorph Modifier [35]</a></li>
            <li><a href="#effects-36">#36 (0x024)  Stat: Save vs. Breath Weapons Modifier [36]</a></li>
            <li><a href="#effects-37">#37 (0x025)  Stat: Save vs. Spells Modifier [37]</a></li>
            <li><a href="#effects-42">#42 (0x02A)  Spell: Wizard Spell Slots Modifier [42]</a></li>
            <li><a href="#effects-44">#44 (0x02C)  Stat: Strength Modifier [44]</a></li>
            <li><a href="#effects-49">#49 (0x031) Stat: Wisdom Modifier [49]</a></li>
            <li><a href="#effects-58">#58 (0x03A)  Cure: Dispellable Effects (Dispel Magic) [58]</a></li>
            <li><a href="#effects-59">#59 (0x03B) Stat: Stealth Modifier [59]</a></li>
            <li><a href="#effects-62">#62 (0x03E)  Spell: Priest Spell Slots Modifier [62]</a></li>
            <li><a href="#effects-74">#74 (0x04A)  State: Blindness [74]</a></li>
            <li><a href="#effects-78">#78 (0x04E)  State: Disease [78]</a></li>
            <li><a href="#effects-90">#90 (0x05A) Stat: Open Locks Modifier [90]</a></li>
            <li><a href="#effects-91">#91 (0x05B) Stat: Find Traps Modifier [91]</a></li>
            <li><a href="#effects-92">#92 (0x05C) Stat: Pick Pockets Modifier [92]</a></li>
            <li><a href="#effects-93">#93 (0x05D) Stat: Fatigue Modifier [93]</a></li>
            <li><a href="#effects-94">#94 (0x05E) Stat: Drunkenness Modifier [94]</a></li>
            <li><a href="#effects-95">#95 (0x05F) Stat: Tracking Skill Modifier [95]</a></li>
            <li><a href="#effects-96">#96 (0x060) Stat: Level Change [96]</a></li>
            <li><a href="#effects-97">#97 (0x061) Stat: Strength-Bonus Modifier [97]</a></li>
            <li><a href="#effects-98">#98 (0x062)  HP: Regeneration [98]</a></li>
            <li><a href="#effects-106">#106 (0x06A) Stat: Morale Break Modifier [106]</a></li>
            <li><a href="#effects-108">#108 (0x06C) Stat: Reputation [108]</a></li>
            <li><a href="#effects-119">#119 (0x077)  Spell Effect: Mirror Image [119]</a></li>
            <li><a href="#effects-135">#135 (0x087) Graphics: Polymorph into Specific [135]</a></li>
            <li><a href="#effects-144">#144 (0x090)  Button: Disable Button [144]</a></li>
            <li><a href="#effects-147">#147 (0x093)  Spell: Learn Spell [147]</a></li>
            <li><a href="#effects-164">#164 (0x0A4)  Cure: Drunkeness [164]</a></li>
            <li><a href="#effects-166">#166 (0x0A6)  Stat: Magical Resistance Modifier [166]</a></li>
            <li><a href="#effects-173">#173 (0x0AD)  Stat: Set Poison Resistance [173]</a></li>
            <li><a href="#effects-177">#177 (0x0B1)  Use EFF File [177]</a></li>
            <li><a href="#effects-181">#181 (0x0B5)  Item: Can't Use Itemtype [181]</a></li>
            <li><a href="#effects-182">#182 (0x0B6)  Item: Apply Effect Item [182]</a></li>
            <li><a href="#effects-183">#183 (0x0B7)  Item: Apply Effect Itemtype [183]</a></li>
            <li><a href="#effects-191">#191 (0x0BF)  Spell: Casting Level Modifier [191]</a></li>
            <li><a href="#effects-218">#218 (0x0DA)  Protection: Stoneskin [218]</a></li>
            <li><a href="#effects-232">#232 (0x0E8)  Spell Effect: Cast Spell on Condition [232]</a></li>
            <li><a href="#effects-233">#233 (0x0E9)  Stat: Proficiency Modifier [233]</a></li>
            <li><a href="#effects-238">#238 (0x0EE) Death: Disintegrate [238]</a></li>
            <li><a href="#effects-272">#272 (0x110)  Spell: Apply Repeating EFF [272]</a></li>
            <li><a href="#effects-273">#273 (0x111)  Remove: Specific Area Effect(Zone of Sweet Air) [273]</a></li>
            <li><a href="#effects-279">#279 (0x117)  Button: Enable Button [279]</a></li>
            <li><a href="#effects-298">#298 (0x12A)  Cutscene 2 [298]</a></li>
            <li><a href="#effects-303">#303 (0x12F)  Spell Effect: Backstab On Condition [303]</a></li>
          </ul>
          <p>TobEx also adds the following new effect opcodes:</p>
          <ul>
            <li><a href="#effects-318">#318 (0x13E)  Stat: Set Stat [318]</a></li>
          </ul>
          <hr />
          <a name="effects-1" id="effects-1"></a><p><strong>#1 (0x001)  Stat: Attacks Per Round Modifier [1]</strong><br />
          <i>TobEx fixes this effect opcode so that stacking this opcode stacks the number of attacks, not the key. The transformation is done internally, so that the key value is still stored in the effect.</i><br />
          Parameter #1: Value<br />
          Parameter #2: Type<br />
          Description:<br />
          Alters a characters Attacks per Round in the style specified by 'Type' field.</p>
          <table class="important">
            <tr>
              <td>Key</td>
              <td>Attacks Per Round</td>
            </tr>
            <tr>
              <td>0</td>
              <td>0</td>
            </tr>
            <tr>
              <td>1</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>2</td>
            </tr>
            <tr>
              <td>3</td>
              <td>3</td>
            </tr>
            <tr>
              <td>4</td>
              <td>4</td>
            </tr>
            <tr>
              <td>5</td>
              <td>5</td>
            </tr>
            <tr>
              <td>6</td>
              <td>0.5</td>
            </tr>
            <tr>
              <td>7</td>
              <td>1.5</td>
            </tr>
            <tr>
              <td>8</td>
              <td>2.5</td>
            </tr>
            <tr>
              <td>9</td>
              <td>3.5</td>
            </tr>
            <tr>
              <td>10</td>
              <td>4.5</td>
            </tr>
          </table>
          <p>Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Key = Key + Value [Value is of type 'Key' with support for negative keys]<br />
          1   Flat Value Modifier -> Key = Value [Value is of type 'Key']<br />
          2   Percentage Modifier -> Key = Key * value / 100 [Value is of type 'positive integer', with rounding to the nearest 0.5 attacks]</p>
          <hr />
          <a name="effects-2" id="effects-2"></a><p><strong>#2 (0x002)  Cure: Sleep [2]</strong><br />
          <i>TobEx fixes this effect opcode so that it correctly removes the Sleep effect opcode</i></p>
          <hr />
          <a name="effects-6" id="effects-6"></a><p><strong>#6 (0x006) Stat: Charisma Modifier [6]</strong><br />
          <i>TobEx fixes a bug so that a net negative charisma value will limit to 0 rather than wrap to 25. This removes an exploit involving the Rod of Terror and the Ring of Human Influence</i></p>
          <hr />
          <a name="effects-10" id="effects-10"></a><p><strong>#10 (0x00A) Stat: Constitution Modifier [10]</strong><br />
          <i>TobEx fixes a bug so that a net negative constitution value will limit to 0 rather than wrap to 25</i></p>
          <hr />
          <a name="effects-12" id="effects-12"></a><p><strong>#12 (0x00C)  HP: Damage [12]</strong><br />
          <i>TobEx fixes three bugs with this effect opcode:</p>
          <ul>
            <li>killing someone with magic fire damage would cause a WEIRD damage assertion failure, and</li>
            <li>hitting someone with magic cold damage would not play a hit sound</li>
            <li>memory leak when fist damage would make the target unconscious</li>
          </ul>
          <p>TobEx allows the scaling of damage type by percentage by using custom scripting stats #387 to #399. Also refer to the <a href="#stats">Scripting Stats</a> section.</p>
          <p>TobEx implements bit 24 (Bypass Mirror Images) of the EFF V2.0 Header offset 0x0040 (Save Type), ITM V1.0 Feature Block offset 0x0024 (Save Type), and SPL V1.0 Feature Block offset 0x0024 (Save Type). When set the mirror image check is skipped on the target creature when checking saving throw.</p>
          <p><strong>Option:</strong> TobEx gives the option of implementing a concentration check affecting spellcasters being hit. Instead of always being interrupted when hit, spellcasters have a chance of their spells being interrupted. In the current implementation, a spellcaster passes the concentration check if:</i></p>
          <p class="important">(1D20 + luck) > (spell level + damage taken)</p>
          <p><i><strong>Option:</strong> TobEx gives the option of not interrupting a creature's spellcasting if a creature takes zero damage (i.e. immune)</i></p>
          <p><i><strong>Option:</strong> TobEx gives the option of causing sleeping creatures to awaken when hit.</i></p>
          <hr />
          <a name="effects-13" id="effects-13"></a><p><strong>#13 (0x00D)  Death: Instant Death [13]</strong><br />
          <i><strong>Option:</strong> TobEx gives the option of making a creature dying of disintegrate, frozen death, and/or stone death drop all non-critical items</i></p>
          <hr />
          <a name="effects-15" id="effects-15"></a><p><strong>#15 (0x00F)  Stat: Dexterity Modifier [15]</strong><br />
          <i>TobEx fixes a bug so that a net negative dexterity value will limit to 0 rather than wrap to 25. TobEx also adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Dexterity = Dexterity + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Dexterity = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Dexterity = (Dexterity * 'Statistic Modifier' value) / 100<br />
          3   Cats Grace Spell</p>
          <p>For a Type of 3 (Cat's Grace Spell), dexterity is modified as per Icewind Dale Cat's Grace spell behaviour, externalised to CLSSPLAB.2DA, in which 1Dx dexterity is gained up to a maximum of 20 depending on the player's class (defaults to 1D6 if class is not present), where x is specified by the DEX column.</p>
          <hr />
          <a name="effects-19" id="effects-19"></a><p><strong>#19 (0x013) Stat: Intelligence Modifier [19]</strong><br />
          <i>TobEx fixes a bug so that a net negative intelligence value will limit to 0 rather than wrap to 25</i></p>
          <hr />
          <a name="effects-20" id="effects-20"></a><p><strong>#20 (0x014)  State: Invisibility [20]</strong><br />
          <i>TobEx fixes the application of improved invisibility under permanent until death timing</i></p>
          <hr />
          <a name="effects-21" id="effects-21"></a><p><strong>#21 (0x015) Stat: Lore Modifier [21]</strong><br />
          <i>TobEx fixes a bug so that a net negative lore value will limit to 0 rather than wrap to 100</i></p>
          <hr />
          <a name="effects-22" id="effects-22"></a><p><strong>#22 (0x016)  Stat: Cumulative Luck Bonus [22]</strong><br />
          <i>TobEx adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Luck = Luck + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Luck = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Luck = (Luck * 'Statistic Modifier' value) / 100<br />
          3   Instantaneous Cumulative Modifier -> Luck = Luck + 'Statistic Modifier' value</p>
          <p>For a non-permanent timing, the instantaneous cumulative modifier immediately adds the 'Statistic Modifier' value, unlike the cumulative modifier which adds the 'Statistic Modifier' after all effects are applied. The former has the disadvantage that it will be overriden by any subsequent flat value modifiers. Percentage modifiers override all other modifiers.</p>
          <hr />
          <a name="effects-25" id="effects-25"></a><p><strong>#25 (0x019)  State: Poison [25]</strong><br />
          <i>TobEx fixes a bug with the poison effect opcode where a creature with multiple instances of disease, poison, wing buffet, regeneration and/or repeating effect opcodes would only have the highest frequency instance applied</i></p>
          <hr />
          <a name="effects-33" id="effects-33"></a><p><strong>#33 (0x021)  Stat: Save vs. Death Modifier [33]</strong><br />
          <i>TobEx fixes a bug so that the save value correctly limits to -20 or 20, rather than a net negative save value wrapping to 20. TobEx adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Save = Save + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Save = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Save = (Save * 'Statistic Modifier' value) / 100<br />
          3   Instantaneous Cumulative Modifier -> Save = Save + 'Statistic Modifier' value</p>
          <p>'Statistic Modifier' can be positive or negative.<br />
          <br />
          For a non-permanent timing, the instantaneous cumulative modifier immediately adds the 'Statistic Modifier' value, unlike the cumulative modifier which adds the 'Statistic Modifier' after all effects are applied. The former has the disadvantage that it will be overriden by any subsequent flat value modifiers. Percentage modifiers override all other modifiers.</p>
          <hr />
          <a name="effects-34" id="effects-34"></a><p><strong>#34 (0x022)  Stat: Save vs. Wands Modifier [34]</strong><br />
          <i>TobEx fixes a bug so that the save value correctly limits to -20 or 20, rather than a net negative save value wrapping to 20. TobEx adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Save = Save + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Save = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Save = (Save * 'Statistic Modifier' value) / 100<br />
          3   Instantaneous Cumulative Modifier -> Save = Save + 'Statistic Modifier' value</p>
          <p>'Statistic Modifier' can be positive or negative.<br />
          <br />
          For a non-permanent timing, the instantaneous cumulative modifier immediately adds the 'Statistic Modifier' value, unlike the cumulative modifier which adds the 'Statistic Modifier' after all effects are applied. The former has the disadvantage that it will be overriden by any subsequent flat value modifiers. Percentage modifiers override all other modifiers.</p>
          <hr />
          <a name="effects-35" id="effects-35"></a><p><strong>#35 (0x023)  Stat: Save vs. Petrification/Polymorph Modifier [35]</strong><br />
          <i>TobEx fixes a bug so that the save value correctly limits to -20 or 20, rather than a net negative save value wrapping to 20. TobEx adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Save = Save + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Save = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Save = (Save * 'Statistic Modifier' value) / 100<br />
          3   Instantaneous Cumulative Modifier -> Save = Save + 'Statistic Modifier' value</p>
          <p>'Statistic Modifier' can be positive or negative.<br />
          <br />
          For a non-permanent timing, the instantaneous cumulative modifier immediately adds the 'Statistic Modifier' value, unlike the cumulative modifier which adds the 'Statistic Modifier' after all effects are applied. The former has the disadvantage that it will be overriden by any subsequent flat value modifiers. Percentage modifiers override all other modifiers.</p>
          <hr />
          <a name="effects-36" id="effects-36"></a><p><strong>#36 (0x024)  Stat: Save vs. Breath Weapons Modifier [36]</strong><br />
          <i>TobEx fixes a bug so that the save value correctly limits to -20 or 20, rather than a net negative save value wrapping to 20. TobEx adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Save = Save + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Save = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Save = (Save * 'Statistic Modifier' value) / 100<br />
          3   Instantaneous Cumulative Modifier -> Save = Save + 'Statistic Modifier' value</p>
          <p>'Statistic Modifier' can be positive or negative.<br />
          <br />
          For a non-permanent timing, the instantaneous cumulative modifier immediately adds the 'Statistic Modifier' value, unlike the cumulative modifier which adds the 'Statistic Modifier' after all effects are applied. The former has the disadvantage that it will be overriden by any subsequent flat value modifiers. Percentage modifiers override all other modifiers.</p>
          <hr />
          <a name="effects-37" id="effects-37"></a><p><strong>#37 (0x025)  Stat: Save vs. Spells Modifier [37]</strong><br />
          <i>TobEx fixes a bug so that the save value correctly limits to -20 or 20, rather than a net negative save value wrapping to 20. TobEx adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Save = Save + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Save = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Save = (Save * 'Statistic Modifier' value) / 100<br />
          3   Instantaneous Cumulative Modifier -> Save = Save + 'Statistic Modifier' value</p>
          <p>'Statistic Modifier' can be positive or negative.<br />
          <br />
          For a non-permanent timing, the instantaneous cumulative modifier immediately adds the 'Statistic Modifier' value, unlike the cumulative modifier which adds the 'Statistic Modifier' after all effects are applied. The former has the disadvantage that it will be overriden by any subsequent flat value modifiers. Percentage modifiers override all other modifiers.</p>
          <hr />
          <a name="effects-42" id="effects-42"></a><p><strong>#42 (0x02A)  Spell: Wizard Spell Slots Modifier [42]</strong><br />
          <i>TobEx adds parameter 2 value 512</i><br />
          Parameter #1: Slot Amount Modifier<br />
          Parameter #2: Spell Level<br />
          Description:<br />
          Alters the number of wizard spell slots available to the targeted creature(s), as specified by the 'Slot Amount Modifier' field, at the level specified by the 'Spell Level' field.<br />
          <br />
          Known values for 'Spell Level' are:</p>
          <p class="important">0   Double spells<br />
          1   Level 1<br />
          2   Level 2<br />
          4   Level 3<br />
          8   Level 4<br />
          16  Level 5<br />
          32  Level 6<br />
          64  Level 7<br />
          128 Level 8<br />
          256 Level 9<br />
          512 Double spells</p>
          <p>For a 'Spell Level' of 0, the amount of spell slots is doubled for the level specified by the 'Slot Amount Modifier' value and all levels below. For a 'Spell Level' of 512, the amount of spell slots is doubled for the level(s) specified by the 'Slot Amount Modifier' field, where a value of 0 is level 1 and a value of 8 is level 9. The target creature(s) must have at least 1 slot at the selected level to have their slot count changed. If the resultant slot count is negative, the creature is given 12 slots.<br />
          <br />
          'Statistic Modifier' can be positive or negative.</p>
          <hr />
          <a name="effects-44" id="effects-44"></a><p><strong>#44 (0x02C)  Stat: Strength Modifier [44]</strong><br />
          <i>TobEx fixes a bug so that a net negative strength value will limit to 0 rather than wrap to 25. TobEx also adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0 Cumulative Modifier -> Strength = Strength + 'Statistic Modifier' value<br />
          1 Flat Value Modifier -> Strength = 'Statistic Modifier' value<br />
          2 Percentage Modifier -> Strength = (Strength * 'Statistic Modifier' value) / 100<br />
          3 Strength Spell</p>
          <p>For a Type of 3 (Strength Spell), strength is modified as per Icewind Dale Strength spell behaviour, externalised to CLSSPLAB.2DA, in which 1Dx strength is gained up to a maximum of 18/&lt;STREX value&gt; depending on the player's class (defaults to 1D6 if class is not present), where x is specified by the STR column. Unit increments between 18 and 19 depend on differences detected in the STRMODEX.2DA table. The 'Statistic Modifier' value overrides the CLSSPLAB.2DA entry, specifying the die size and allowing a maximum strength of 18/00.<br />
          <br />
          FlameWing's description of Strength Spell: "IWD1/P&P Strength Spell With a slight change, in that param1 != 0 means dice size to roll for all classes and allows exceptional strength bonuses for non-warrior classes. For example, param1 = 4 rolls a d4 for strength increase, similar to P&P Strength of Stone spell. In all cases, strength cannot become 19 or more."</p>
          <hr />
          <a name="effects-49" id="effects-49"></a><p><strong>#49 (0x031) Stat: Wisdom Modifier [49]</strong><br />
          <i>TobEx fixes a bug so that a net negative wisdom value will limit to 0 rather than wrap to 25</i></p>
          <hr />
          <a name="effects-58" id="effects-58"></a><p><strong>#58 (0x03A)  Cure: Dispellable Effects (Dispel Magic) [58]</strong><br />
          <i>TobEx adds parameter 2 high and corrects the formula used to determine whether dispel is successful</i><br />
          <i>TobEx implements bit 24 (Not dispellable in magical weapon slot) to the ITM V1.0 Header offset 0x0018 (Flags). Items with this flag set cannot be dispelled by this effect opcode</i><br />
          Parameter #1: Level<br />
          Parameter #2 Low: Type<br />
          Parameter #2 High: Magical weapon dispel behaviour<br />
          Description:<br />
          Dispels magic from the targeted creature(s). Depending on the value of the 'Type' field, the 'Level' field can be used to set the level of the effect.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0 Always dispel<br />
          1 Use Caster Level<br />
          2 Use 'Level' field</p>
          <p>Known values for 'Magical weapon dispel behaviour' are:</p>
          <p class="important">0 Always dispel<br />
          1 Do not dispel<br />
          2 Chance of dispel (target level is the higher of the effective mage or cleric level, whichever is higher)</p>
          <p>With 'Type' of 1 or 2, the base chance of successfully dispelling is 50%. This chance is modified by the relative levels of the dispeller to the target.<br />
          Each level below target gives a -10% chance, each level above target gives a +5% chance. There is always a 1% chance of success or failure.</p>
          <hr />
          <a name="effects-59" id="effects-59"></a><p><strong>#59 (0x03B) Stat: Stealth Modifier [59]</strong><br />
          <i>TobEx fixes a bug so that an out of bounds move silently skill will limit to 0 or 255 rather than wrap around</i></p>
          <hr />
          <a name="effects-62" id="effects-62"></a><p><strong>#62 (0x03E)  Spell: Priest Spell Slots Modifier [62]</strong><br />
          <i>Added parameter 2 value 3</i><br />
          Parameter #1: Slot Amount Modifier<br />
          Parameter #2: Spell Level<br />
          Description:<br />
          Alters the number of priest spell slots available to the targeted creature(s), as specified by the 'Slot Amount Modifier' field, at the level specified by the 'Spell Level' field.<br />
          <br />
          Known values for 'Spell Level' are:</p>
          <p class="important">0   Double spells<br />
          1   Level 1<br />
          2   Level 2<br />
          4   Level 3<br />
          8   Level 4<br />
          16  Level 5<br />
          32  Level 6<br />
          64  Level 7<br />
          512 Double spells</p>
          <p>For a 'Spell Level' of 0, the amount of spell slots is doubled for the level specified by the 'Slot Amount Modifier' value and all levels below. For a 'Spell Level' of 512, the amount of spell slots is doubled for the level(s) specified by the 'Slot Amount Modifier' field. The target creature(s) must have at least 1 slot at the selected level to have their slot count changed. If the resultant slot count is negative, the creature is given 12 slots.<br />
          <br />
          'Statistic Modifier' can be positive or negative.</p>
          <hr />
          <a name="effects-74" id="effects-74"></a><p><strong>#74 (0x04A)  State: Blindness [74]</strong><br />
          <i>TobEx fixes this effect opcode to prevent stacking of the THAC0 penalty when a creature is affected by multiple copies of this effect opcode</i></p>
          <p><strong>Option:</strong> TobEx gives the option of modifying this effect opcode to match the Blindness spell description in the game. If used, Blindness gives a -4 to hit and 4 point armor penalty instead of a -10 to hit penalty.</p>
          <hr />
          <a name="effects-78" id="effects-78"></a><p><strong>#78 (0x04E)  State: Disease [78]</strong><br />
          <i>TobEx fixes a bug with the disease effect opcode for parameter 2 values 0-3 where a creature with multiple instances of disease, poison, wing buffet, regeneration and/or repeating effect opcodes would only have the highest frequency instance applied</i></p>
          <hr />
          <a name="effects-90" id="effects-90"></a><p><strong>#90 (0x05A) Stat: Open Locks Modifier [90]</strong><br />
          <i>TobEx fixes a bug so that an out of bounds open locks skill will limit to 0 or 255 rather than wrap around</i></p>
          <hr />
          <a name="effects-91" id="effects-91"></a><p><strong>#91 (0x05B) Stat: Find Traps Modifier [91]</strong><br />
          <i>TobEx fixes a bug so that an out of bounds find traps skill will limit to 0 or 255 rather than wrap around</i></p>
          <hr />
          <a name="effects-92" id="effects-92"></a><p><strong>#92 (0x05C) Stat: Pick Pockets Modifier [92]</strong><br />
          <i>TobEx fixes a bug so that an out of bounds pick pockets skill will limit to 0 or 255 rather than wrap around</i></p>
          <hr />
          <a name="effects-93" id="effects-93"></a><p><strong>#93 (0x05D) Stat: Fatigue Modifier [93]</strong><br />
          <i>TobEx fixes a bug so that a net negative fatigue limit value will limit to 0 rather than wrap to 100</i></p>
          <hr />
          <a name="effects-94" id="effects-94"></a><p><strong>#94 (0x05E) Stat: Drunkenness Modifier [94]</strong><br />
          <i>TobEx fixes a bug so that a net negative intoxication value will limit to 0 rather than wrap to 100</i></p>
          <hr />
          <a name="effects-95" id="effects-95"></a><p><strong>#95 (0x05F) Stat: Tracking Skill Modifier [95]</strong><br />
          <i>TobEx fixes a bug so that an out of bounds tracking skill will limit to 0 or 255 rather than wrap around</i></p>
          <hr />
          <a name="effects-96" id="effects-96"></a><p><strong>#96 (0x060) Stat: Level Change [96]</strong><br />
          <i>TobEx fixes a bug so that a net negative level will limit to 0 rather than wrap to 100</i></p>
          <hr />
          <a name="effects-97" id="effects-97"></a><p><strong>#97 (0x061) Stat: Strength-Bonus Modifier [97]</strong><br />
          <i>TobEx fixes a bug so that a net negative strength extra value will limit to 0 rather than wrap to 100</i></p>
          <hr />
          <a name="effects-98" id="effects-98"></a><p><strong>#98 (0x062) HP: Regeneration [98]</strong><br />
          <i>TobEx fixes a bug with the regeneration opcode where a creature with multiple instances of disease, poison, wing buffet, regeneration and/or repeating effect opcodes would only have the highest frequency instance applied</i></p>
          <hr />
          <a name="effects-106" id="effects-106"></a><p><strong>#106 (0x06A) Stat: Morale Break Modifier [106]</strong><br />
          <i>TobEx fixes a bug so that an out of bounds morale break value will limit to 0 or 255 rather than wrap around</i></p>
          <hr />
          <a name="effects-108" id="effects-108"></a><p><strong>#108 (0x06C) Stat: Reputation [108]</strong><br />
          <i>TobEx fixes a bug so that an out of bounds reputation value will limit to 0 or 255 rather than wrap around</i></p>
          <hr />
          <a name="effects-119" id="effects-119"></a><p><strong>#119 (0x077) Spell Effect: Mirror Image [119]</strong><br />
          <i><strong>Option:</strong> TobEx gives the option of modifying the mirror image effect opcode to keep caster level, so that dispel magic will work on it</i></p>
          <hr />
          <a name="effects-135" id="effects-135"></a><p><strong>#135 (0x087) Graphics: Polymorph into Specific [135]</strong><br />
          <i>TobEx fixes a bug with parameter 2 values of 1 (Appearance only) where changes to the character's colour would either not work, or revert back to normal colours on refreshing the character. The <a href="#effects-177">Use EFF File opcode</a> is fixed to prevent stuttering associated with using Polymorph opcode as a child effect.</i></p>
          <hr />
          <a name="effects-144" id="effects-144"></a><p><strong>#144 (0x090)  Button: Disable Button [144]</strong><br />
          <i>TobEx adds parameter 2 values 10 and 14. The button disabled states are tied to new hard-coded STATS.IDS opcodes 308-322, inclusive. Also refer to the <a href="#stats">Scripting Stats</a> section.</i><br />
          Parameter #1: Irrelevant<br />
          Parameter #2: Button<br />
          Description:<br />
          Disabled the button specified by the 'Button' field.<br />
          <br />
          Known values for 'Button' are:</p>
          <p class="important">0   Stealth Button<br />
          1   Thieving Skill Button<br />
          2   Spell Select Button<br />
          3   First Quick Spell Button<br />
          4   Second Quick Spell Button<br />
          5   Third Quick Spell Button<br />
          6   Turn Undead Button<br />
          7   Talk Button<br />
          8   Use Item Button<br />
          9   First Quick Item Button<br />
          10  Bard Song Button<br />
          11  Second Quick Item Button<br />
          12  Third Quick Item Button<br />
          13  Innate Ability Button<br />
          14  Find Traps Button</p>
          <hr />
          <a name="effects-147" id="effects-147"></a><p><strong>#147 (0x093)  Spell: Learn Spell [147]</strong><br />
          <i>TobEx adds parameter 1 high</i><br />
          Parameter #1 Low: Irrelevant<br />
          Parameter #1 High: Flags<br />
          Parameter #2: Irrelevant<br />
          Description:<br />
          The targeted creature(s) tries to learn the spell specified by the resource key.<br />
          Learning is successful when 1D100 &lt;= the INT-dependent LEARN_SPELL value in INTBON.2DA.<br />
          The LEARN_SPELL value is modified for mage specialists, with +15 for same school spells, and -15 for non-same school spells.<br />
          <br />
          The 'Flags' field modifies the behaviour of the effect in the following manners:</p>
          <p class="important">Bit 0: Learning the spell never gives experience (including scrolls from the inventory screen)<br />
          Bit 1: No effect (reserved for GemRB)<br />
          Bit 2: Learning is always successful (including scrolls from the inventory screen)<br />
          Bit 3: No effect (reserved for GemRB)<br />
          Bit 4: If the spell is already learnt, no experience is given (excludes inventory screen)<br />
          Bit 5: Learning the spell obeys mage school exclusions (excludes inventory screen)<br />
          Bit 6: The spell cannot be learnt by sorcerer class (excludes inventory screen)<br />
          Bit 7: Learning fails if the target has already learnt the maximum number of spells as per INTMOD.2DA for the spell's level (excludes inventory screen)</p>
          <hr />
          <a name="effects-164" id="effects-164"></a><p><strong>#164 (0x0A4)  Cure: Drunkeness [164]</strong><br />
          <i>TobEx fixes this effect opcode so that it correctly removes the Drunkenness effect opcode</i></p>
          <hr />
          <a name="effects-166" id="effects-166"></a><p><strong>#166 (0x0A6)  Stat: Magical Resistance Modifier [166]</strong><br />
          <i>TobEx fixes the effect opcode behaviour for permanent until death timing and adds parameter 2 value 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Instantaneous Cumulative Modifier -> Value = Value + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Value = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Value = (Value * 'Statistic Modifier' value) / 100<br />
          3   Cumulative Modifier -> Value = Value + 'Statistic Modifier' value</p>
          <p>For a non-permanent timing, the instantaneous cumulative modifier immediately adds the 'Statistic Modifier' value, unlike the cumulative modifier which adds the 'Statistic Modifier' after all effects are applied. The former has the disadvantage that it will be overriden by any subsequent flat value modifiers. Percentage modifiers override all other modifiers.</p>
          <hr />
          <a name="effects-173" id="effects-173"></a><p><strong>#173 (0x0AD)  Stat: Set Poison Resistance [173]</strong><br />
          <i>TobEx adds paramter 2 values 1 to 3</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Flat Value Modifier -> Value = 'Statistic Modifier' value<br />
          1   Cumulative Modifier -> Value = Value + 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Value = (Value * 'Statistic Modifier' value) / 100<br />
          3   Instantaneous Cumulative Modifier -> Value = Value + 'Statistic Modifier' value</p>
          <p>Note that the 'Percentage Modifier' type (2) is applied before the 'Cumulative Modifier' types (1) are applied.</p>
          <hr />
          <a name="effects-177" id="effects-177"></a><p><strong>#177 (0x0B1)  Use EFF File [177]</strong><br />
          <i>TobEx fixes this effect opcode so that adjustments to child effect parameters 1 to 4 are saved in unused internal structures of this opcode and restored to the child effect on next application. This fixes stutter issues associated with the <a href="#effects-135">Polymorph</a> (parameter 2 value 1) opcode and is required for the changes to the <a href="#effects-15">Dexterity Modifier</a> (parameter 2 value 3), <a href="#effects-25">Poison</a>, <a href="#effects-44">Strength Modifier</a> (parameter 2 value 3), <a href="#effects-78">Disease</a>, <a href="#effects-98">Regeneration</a>, and <a href="#effects-272">Apply Repeating EFF</a> opcodes to work correctly when used as child effects of this effect.<br />
          TobEx also fixes memory deallocation issues associated with containers and doors that use this effect opcode in their trap scripts</i></p>
          <hr />
          <a name="effects-181" id="effects-181"></a><p><strong>#181 (0x0B5)  Item: Can't Use Itemtype [181]</strong><br />
          <i>TobEx fixes this effect opcode so that it works correctly when parameter 2 is non-zero</i></p>
          <hr />
          <a name="effects-182" id="effects-182"></a><p><strong>#182 (0x0B6)  Item: Apply Effect Item [182]</strong><br />
          <i>TobEx restores the function of this effect opcode</i><br />
          Parameter #1: Undetermined<br />
          Parameter #2: Undetermined<br />
          Description:<br />
          Applies the effect specified by the resource 2 key to the targeted creature(s) when an item specified by the resource key is equipped. Due to the use of the resource 2 key, this effect must be used in an EFF file.<br />
          <br />
          Limitations: the effect is applied again if an already equipped matching item is used to force-attack a target via the quickbar.</p>
          <hr />
          <a name="effects-183" id="effects-183"></a><p><strong>#183 (0x0B7)  Item: Apply Effect Itemtype [183]</strong><br />
          <i>TobEx restores the function of this effect opcode</i><br />
          Parameter #1: String Reference<br />
          Parameter #2: Type<br />
          Description:<br />
          Applies the effect specified by the resource key to the targeted creature(s) when an item of the item type specified by the 'Type' field is equipped. The 'String Reference' field is currently unused.<br />
          <br />
          Limitations: the effect is applied again if an already equipped matching itemtype is used to force-attack a target via the quickbar.</p>
          <hr />
          <a name="effects-191" id="effects-191"></a><p><strong>#191 (0x0BF)  Spell: Casting Level Modifier [191]</strong><br />
          <i>TobEx made no direct changes to this effect opcode. However, TobEx applies the stats CASTINGLEVELBONUSMAGE and CASTINGLEVELBONUSCLERIC modified by this effects opcode to spells being cast. These stats were previously unused.</i></p>
          <hr />
          <a name="effects-218" id="effects-218"></a><p><strong>#218 (0x0DA)  Protection: Stoneskin [218]</strong><br />
          <i><strong>Option:</strong> TobEx gives the option of removing the grey colour change to a character who applies this effect opcode.</i></p>
          <hr />
          <a name="effects-232" id="effects-232"></a><p><strong>#232 (0x0E8)  Spell Effect: Cast Spell on Condition [232]</strong><br />
          <i>TobEx adds parameter 2 high</i><br />
          Parameter #1: Target<br />
          Parameter #2 Low: Condition<br />
          Parameter #2 High: Trigger Check Period<br />
          Description:<br />
          Casts the spell specified by the resource field on the target specified by the 'Target' field, when the condition from the 'Condition' field is true. The conditions are akin to various triggers.<br />
          The trigger check period field specifies how often (in ticks) the condition is checked. If set to 0, the trigger check period is set to the game default of 100 ticks.<br />
          <br />
          Known values for 'Target' are:</p>
          <p class="important">0   Effect Target<br />
          1   LastHitter<br />
          2   NearestEnemyOf<br />
          3   Nearest</p>
          <p>Known values for 'Condition' are:</p>
          <p class="important">0   HitBy()<br />
          1   See(NearestEnemyOf())<br />
          2   HPPercentLT(Myself 50)<br />
          3   HPPercentLT(Myself 25)<br />
          4   HPPercentLT(Myself 10)<br />
          5   StateCheck(Myself,STATE_HELPLESS) i.e. unconscious<br />
          6   StateCheck(Myself,STATE_POISONED) i.e. poisoned<br />
          7   AttackedBy('Target')<br />
          8   PersonalSpaceDistance('Target',4)<br />
          9   PersonalSpaceDistance('Target',10)<br />
          10  Unknown - every round<br />
          11  TookDamage()</p>
          <p>A non-zero Parameter 3 Low value activates the portrait icon, immediately triggers the HitBy() trigger, and prevents purging of the conditional spell after the condition is true.<br />
          Parameter 3 High is reserved for internal use (specifies that Parameter 4 has been set).<br />
          Parameter 4 is reserved for internal use (set to the game time when the effect is first applied).</p>
          <hr />
          <a name="effects-233" id="effects-233"></a><p><strong>#233 (0x0E9) Stat: Proficiency Modifier [233]</strong><br />
          <i>TobEx adds parameter 2 high</i><br />
          Parameter #1: Amount<br />
          Parameter #2 Low: Type<br />
          Parameter #2 High: Behaviour<br />
          Description:<br />
          <br />
          Applies 'Behaviour' to the weapon proficiency points for the weapon type specified in the 'Type' field with the value specified by the 'Amount' field, for the targeted creature(s).<br />
          <br />
          Values for 'Behaviour' are:</p>
          <p class="important">0 Set proficiency 'Type' to 'Amount' only if 'Amount' is higher than the current proficiency points<br />
          1 Proficiency points of 'Type' = Proficiency points of 'Type' + 'Amount' (applied after all of Behaviour 0)</p>
          <p>Known values for 'Type' are:</p>
          <table class="important">
            <tr>
              <td>Axe</td>
              <td>92</td>
            </tr>
            <tr>
              <td>Bastard Sword</td>
              <td>89</td>
            </tr>
            <tr>
              <td>Blackjack</td>
              <td>108</td>
            </tr>
            <tr>
              <td>Club</td>
              <td>115</td>
            </tr>
            <tr>
              <td>Crossbow</td>
              <td>103</td>
            </tr>
            <tr>
              <td>Dagger</td>
              <td>96</td>
            </tr>
            <tr>
              <td>Darts</td>
              <td>106</td>
            </tr>
            <tr>
              <td>Flail/Morningstar</td>
              <td>100</td>
            </tr>
            <tr>
              <td>Gun</td>
              <td>109</td>
            </tr>
            <tr>
              <td>Halberd</td>
              <td>99</td>
            </tr>
            <tr>
              <td>Katana</td>
              <td>94</td>
            </tr>
            <tr>
              <td>Long Bow</td>
              <td>104</td>
            </tr>
            <tr>
              <td>Long Sword</td>
              <td>90</td>
            </tr>
            <tr>
              <td>Mace</td>
              <td>101</td>
            </tr>
            <tr>
              <td>Martial Arts</td>
              <td>110</td>
            </tr>
            <tr>
              <td>Quarter Staff</td>
              <td>102</td>
            </tr>
            <tr>
              <td>Scimitar/Wakizashi/Ninja-To</td>
              <td>95</td>
            </tr>
            <tr>
              <td>Short Bow</td>
              <td>105</td>
            </tr>
            <tr>
              <td>Short Sword</td>
              <td>91</td>
            </tr>
            <tr>
              <td>Single Weapon Skill</td>
              <td>113</td>
            </tr>
            <tr>
              <td>Sling</td>
              <td>107</td>
            </tr>
            <tr>
              <td>Spear</td>
              <td>98</td>
            </tr>
            <tr>
              <td>Sword and Shield Skill</td>
              <td>112</td>
            </tr>
            <tr>
              <td>Two-Handed Sword</td>
              <td>93</td>
            </tr>
            <tr>
              <td>Two-Handed Weapon Skill</td>
              <td>111</td>
            </tr>
            <tr>
              <td>Two Weapon Skill</td>
              <td>114</td>
            </tr>
            <tr>
              <td>War Hammer</td>
              <td>97</td>
            </tr>
            <tr>
              <td>Extra Proficiency 2(Unused)</td>
              <td>116</td>
            </tr>
            <tr>
              <td>Extra Proficiency 3(Unused)</td>
              <td>117</td>
            </tr>
            <tr>
              <td>Extra Proficiency 4(Unused)</td>
              <td>118</td>
            </tr>
            <tr>
              <td>Extra Proficiency 5(Unused)</td>
              <td>119</td>
            </tr>
            <tr>
              <td>Extra Proficiency 6(Unused)</td>
              <td>120</td>
            </tr>
            <tr>
              <td>Extra Proficiency 7(Unused)</td>
              <td>121</td>
            </tr>
            <tr>
              <td>Extra Proficiency 8(Unused)</td>
              <td>122</td>
            </tr>
            <tr>
              <td>Extra Proficiency 9(Unused)</td>
              <td>123</td>
            </tr>
            <tr>
              <td>Extra Proficiency 10(Unused)</td>
              <td>124</td>
            </tr>
            <tr>
              <td>Extra Proficiency 11(Unused)</td>
              <td>125</td>
            </tr>
            <tr>
              <td>Extra Proficiency 12(Unused)</td>
              <td>126</td>
            </tr>
            <tr>
              <td>Extra Proficiency 13(Unused)</td>
              <td>127</td>
            </tr>
            <tr>
              <td>Extra Proficiency 14(Unused)</td>
              <td>128</td>
            </tr>
            <tr>
              <td>Extra Proficiency 15(Unused)</td>
              <td>129</td>
            </tr>
            <tr>
              <td>Extra Proficiency 16(Unused)</td>
              <td>130</td>
            </tr>
            <tr>
              <td>Extra Proficiency 17(Unused)</td>
              <td>131</td>
            </tr>
            <tr>
              <td>Extra Proficiency 18(Unused)</td>
              <td>132</td>
            </tr>
            <tr>
              <td>Extra Proficiency 19(Unused)</td>
              <td>133</td>
            </tr>
            <tr>
              <td>Extra Proficiency 20(Unused)</td>
              <td>134</td>
            </tr>
          </table>
          <p>Standard Throne of Bhaal proficiencies are limited to a maximum of 5 stars.</p>
          <hr />
          <a name="effects-238" id="effects-238"></a><p><strong>#238 (0x0EE)  Death: Disintegrate [238]</strong><br />
          <i>TobEx fixes a memory leak associated this effect opcode</i></p>
          <hr />
          <a name="effects-272" id="effects-272"></a><p><strong>#272 (0x110)  Spell: Apply Repeating EFF [272]</strong><br />
          <i>TobEx fixes a bug with the repeating effect opcode where a creature with multiple instances of disease, poison, wing buffet, regeneration and/or repeating effect opcodes would only have the highest frequency instance applied</i></p>
          <hr />
          <a name="effects-273" id="effects-273"></a><p><strong>#273 (0x111)  Remove: Specific Area Effect(Zone of Sweet Air) [273]</strong><br />
          <i>TobEx adds parameter 1 value 1</i><br />
          Parameter #1: Mode<br />
          Parameter #2: Undetermined<br />
          Description:<br />
          If Mode is not 1, removes projectiles listed in clearair.2da and smoke of animation ID 0x5*0 (standard behaviour).<br />
          If Mode is 1, removes projectiles and smoke animations listed in the 2da resource specified in the Resource field.<br />
          If the custom resource is invalid, standard behaviour occurs as if Mode is 0.<br />
          <br />
          The recommended format of the custom 2da resources are as follows:</p>
          <table class="important">
            <tr>
              <td>2DA V1.00</td>
            </tr>
            <tr>
              <td>*</td>
            </tr>
            <tr>
              <td></td>
              <td>Projectile Number</td>
              <td>Smoke Animation</td>
            </tr>
            <tr>
              <td>&lt;PROJECTILE_NAME&gt;</td>
              <td>94</td>
              <td>*</td>
              <td>//for projectile only</td>
            </tr>
            <tr>
              <td>&lt;PROJECTILE_NAME&gt;</td>
              <td>*</td>
              <td>0X0500</td>
              <td>//for smoke animation only</td>
            </tr>
            <tr>
              <td>&lt;PROJECTILE_NAME&gt;</td>
              <td>186</td>
              <td>0X0600</td>
              <td>//for projectile and smoke animation</td>
            </tr>
          </table>
          <p>Note that the smoke animation ID must be specified in hexadecimal, with capital X and must be 4 hexadecimal digits.<br />
          The third digit of the target smoke animation ID is ignored, e.g. 0X0500 will remove smoke animation IDs 0x05*0.</p>
          <hr />
          <a name="effects-279" id="effects-279"></a><p><strong>#279 (0x117)  Button: Enable Button [279]</strong><br />
          <i>TobEx adds parameter 2 values 10 and 14. The button disabled states are tied to new hard-coded STATS.IDS opcodes 308-322, inclusive. Also refer to the <a href="#stats">Scripting Stats</a> section.</i><br />
          Parameter #1: Irrelevant<br />
          Parameter #2: Button<br />
          Description:<br />
          Enables the button specified by the 'Button Type' field.<br />
          <br />
          Known values for 'Button' are:</p>
          <p class="important">0   Stealth Button<br />
          1   Thieving Skill Button<br />
          2   Spell Select Button<br />
          3   First Quick Spell Button<br />
          4   Second Quick Spell Button<br />
          5   Third Quick Spell Button<br />
          6   Turn Undead Button<br />
          7   Talk Button<br />
          8   Use Item Button<br />
          9   First Quick Item Button<br />
          10  Bard Song Button<br />
          11  Second Quick Item Button<br />
          12  Third Quick Item Button<br />
          13  Innate Ability Button<br />
          14  Find Traps Button</p>
          <hr />
          <a name="effects-298" id="effects-298"></a><p><strong>#298 (0x12A) Cutscene 2 [298]</strong><br />
          <i>TobEx adds parameter 1 and parameter 2 value 1</i><br />
          Parameter #1: Store party location behaviour<br />
          Parameter #2: Script<br />
          Description:<br />
          Starts a cutscene.<br />
          <br />
          Values for 'Store party location behaviour':</p>
          <p class="important">0   Use list specifically for pocket plane<br />
          1   Use list normally used by StorePartyLocations() action - restore with RestorePartyLocations() action<br />
          2   Do not store party locations</p>
          <p>Values for 'Use custom script':</p>
          <p class="important">0   Use cut250a.bcs<br />
          1   Use cutscene script specified by the Resource field</p>
          <hr />
          <a name="effects-303" id="effects-303"></a><p><strong>#303 (0x12F)  Spell Effect: Backstab On Condition [303]</strong><br />
          <i>TobEx adds parameter 2 values 2 and 4</i><br />
          Parameter #1: Irrelevant<br />
          Parameter #2: Type (bitfield)<br />
          <br />
          Description:<br />
          The targeted creature(s) will backstab on the conditions set by the 'Type' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0 Normal conditions (attacker must be invisible, attacker must be in 90-degree arc behind victim)<br />
          1 Ignore invisible requirement and positioning requirement<br />
          2 Ignore invisible requirement only<br />
          4 Ignore positioning requirement only</p>
          <hr />
          <a name="effects-318" id="effects-318"></a><p><strong>#318 (0x13E)  Stat: Set Stat [318]</strong><br />
          <i>New</i><br />
          Parameter #1: Statistic Modifier<br />
          Parameter #2 low: Stat Opcode<br />
          Parameter #2 high: Type<br />
          Description:<br />
          Applies the modifier value specified by the 'Statistic Modifier' field in the style specified by the 'Type' field to the opcode specified by the 'Stat Opcode' field.<br />
          <br />
          Known values for 'Type' are:</p>
          <p class="important">0   Cumulative Modifier -> Value = Value + 'Statistic Modifier' value<br />
          1   Flat Value Modifier -> Value = 'Statistic Modifier' value<br />
          2   Percentage Modifier -> Value = (Value * 'Statistic Modifier' value) / 100<br />
          3   Multiplicative Modifier -> Value = Value * 'Statistic Modifier' value<br />
          4   Divisive Modifier -> Value = Value / 'Statistic Modifier' value<br />
          5   Modulus Modifier -> Value = Value % 'Statistic Modifier' value<br />
          6   Logical AND Modifier -> Value = Value && 'Statistic Modifier' value<br />
          7   Logical OR Modifier -> Value = Value || 'Statistic Modifier' value<br />
          8   Bitwise AND Modifier -> Value = Value & 'Statistic Modifier' value<br />
          9   Bitwise OR Modifier -> Value = Value | 'Statistic Modifier' value<br />
          10  Inverse Modifier -> Value = !Value</p>
          <p>You cannot set any stats with opcode &lt; 387 with this effect. New stats 202-400 are reserved for new hard-coded stats.<br />
          <br />
          Modmakers can set the damage type percentage modifiers and weight allowance modifiers using this effect opcode. Also refer to the <a href=#stats>Scripting Stats</a> section.</p>
          <address>
            <span class="footer">TobEx &gt; Effects</span> &#8226;<a href="#top">BACK TO TOP</a>
          </address>
        </div>

        <!-- ================== I t e m s ================== -->
        <a name="items" id="items"></a>
        <div class="content">
          <h2>Items</h2>
          <p>TobEx makes the following changes to the ITM V1.0 file format.</p>
          <h3>Header</h3>
          <table class="important" border="1">
            <tr>
              <td>Offset</td>
              <td>Description</td>
            </tr>
            <tr>
              <td>0x0018 (dword)</td>
              <td>
                <p>Flags</p>
                <ul>
                  <li>bit 24: <a href="#effects-58">not dispellable in magical weapon slot</a></li>
                  <li>bit 25: <a href="#ruleset-critical-hits">toggle critical hit aversion</a></li>
                </ul>
              </td>
            </tr>
          </table>
          <h3>Extended Header (Ability)</h3>
          <table class="important" border="1">
            <tr>
              <td>Offset</td>
              <td>Description</td>
            </tr>
            <tr>
              <td>0x0026 (dword)</td>
              <td>
                <p>Flags</p>
                <ul>
                  <li>bit 25: <a href="#ruleset-backstabbing">toggle backstab restrictions</a></li>
                  <li>bit 26: <a href="#ruleset-targetting-invisible">cannot target invisible</a></li>
                </ul>
              </td>
            </tr>
          </table>
          <h3>Feature Block (Effect)</h3>
          <table class="important" border="1">
            <tr>
              <td>Offset</td>
              <td>Description</td>
            </tr>
            <tr>
              <td>0x0024 (dword)</td>
              <td>
                <p>Flags</p>
                <ul>
                  <li>bit 24: <a href="#effects-12">bypass mirror images</a></li>
                  <li>bit 25: <a href="#engine-effect-stacking">limit effect stacking</a></li>
                  <li>bit 26: <a href="#engine-effect-stacking">internal: suspend effect application</a></li>
                </ul>
              </td>
            <tr>
            </tr>
              <td>0x002c (dword)</td>
              <td>
                <p>Special</p>
                <ul>
                  <li>Vanilla: Used only for Set Local Variable when the variable is non-existant</li>
                  <li><a href="#engine-effect-stacking">Stacking ID</a> when bit 25 of 'Saving throw type' is enabled</li>
                </ul>
              </td>
            </tr>
          </table>
        </div>

        <!-- ================== S p e l l s ================== -->
        <a name="spells" id="spells"></a>
        <div class="content">
          <h2>Spells</h2>
          <p>TobEx makes the following changes to the SPL V1.0 file format.</p>
          <h3>Header</h3>
          <table class="important" border="1">
            <tr>
              <td>Offset</td>
              <td>Description</td>
            </tr>
            <tr>
              <td>0x0018 (dword)</td>
              <td>
                <p>Flags</p>
                <ul>
                  <li>bit 24: <a href="#ruleset-targetting-invisible">can target invisible</a></li>
                  <li>bit 25: <a href="#ruleset-casting-silence">can be cast when silenced</a></li>
                </ul>
              </td>
            </tr>
          </table>
          <h3>Feature Block (Effect)</h3>
          <table class="important" border="1">
            <tr>
              <td>Offset</td>
              <td>Description</td>
            </tr>
            <tr>
              <td>0x0024 (dword)</td>
              <td>
                <p>Flags</p>
                <ul>
                  <li>bit 24: <a href="#effects-12">bypass mirror images</a></li>
                  <li>bit 25: <a href="#engine-effect-stacking">limit effect stacking</a></li>
                  <li>bit 26: <a href="#engine-effect-stacking">internal: suspend effect application</a></li>
                </ul>
              </td>
            <tr>
            </tr>
              <td>0x002c (dword)</td>
              <td>
                <p>Special</p>
                <ul>
                  <li>Vanilla: Used only for Set Local Variable when the variable is non-existant</li>
                  <li><a href="#engine-effect-stacking">Stacking ID</a> when bit 25 of 'Saving throw type' is enabled</li>
                </ul>
              </td>
            </tr>
          </table>
        </div>

        <!-- ================== S t o r e s ================== -->
        <a name="stores" id="stores"></a>
        <div class="content">
          <h2>Stores</h2>
          <p>TobEx makes the following changes to the STO V1.0 file format.</p>
          <h3>Header</h3>
          <table class="important" border="1">
            <tr>
              <td>Offset</td>
              <td>Description</td>
            </tr>
            <tr>
              <td>0x0010 (dword)</td>
              <td>
                <p>Flags</p>
                <ul>
                  <li>bit 14: <a href="#engine-item_recharge">toggle recharge</a></li>
                </ul>
              </td>
            </tr>
          </table>
        </div>

      </div>
    </div>

</body>
</html>